{"ast":null,"code":"import _defineProperty from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/davidkang/Desktop/local-barz/src/containers/Scribble/MyBars/ViewedBar/PostLikes/PostLikes.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component, useState, useEffect } from 'react';\nimport { connect } from 'react-redux';\nimport firebase from 'firebase';\nimport 'firebase/firestore';\nimport './PostLikes.css';\nimport { setTimeout } from 'timers';\n\nconst PostLikes = props => {\n  // data\n  const _useState = useState(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        points = _useState2[0],\n        setPoints = _useState2[1];\n\n  const _useState3 = useState(0),\n        _useState4 = _slicedToArray(_useState3, 2),\n        likes = _useState4[0],\n        setLikes = _useState4[1];\n\n  const _useState5 = useState(0),\n        _useState6 = _slicedToArray(_useState5, 2),\n        dislikes = _useState6[0],\n        setDislikes = _useState6[1];\n\n  const _useState7 = useState(null),\n        _useState8 = _slicedToArray(_useState7, 2),\n        myVote = _useState8[0],\n        setMyVote = _useState8[1];\n\n  useEffect(() => {\n    const showTimeOut = () => {\n      window.clearTimeout(closeTimeout);\n      openTimeout = window.setTimeout(function () {\n        voter.classList.add('show');\n        voter.classList.remove('hide');\n      }, 750);\n    };\n\n    const removeTimeOut = () => {\n      window.clearTimeout(openTimeout);\n      closeTimeout = window.setTimeout(function () {\n        voter.classList.remove('show');\n        voter.classList.add('hide');\n      }, 750);\n    };\n\n    var openTimeout = null;\n    var closeTimeout = null;\n    const voter = document.getElementById('voter');\n    const voteIcon = document.getElementById('vote-icon');\n    voteIcon.addEventListener('mouseover', showTimeOut);\n    voter.addEventListener('mouseover', () => window.clearTimeout(closeTimeout));\n    voteIcon.addEventListener('mouseout', removeTimeOut);\n    return () => {};\n  }, []);\n  useEffect(() => {\n    const db = firebase.firestore();\n    const votesListener = db.collection('postVotes').where('pid', '==', props.viewedPost.pid).onSnapshot(snapshot => {\n      var points = 0;\n      var likes = 0;\n      var dislikes = 0;\n      var myVote = []; // for every vote of this post\n\n      snapshot.docs.forEach(vote => {\n        vote = _objectSpread({}, vote.data(), {\n          vid: vote.id\n        });\n\n        if (vote.value === 1) {\n          likes += 1;\n        }\n\n        if (vote.value === -1) {\n          dislikes += 1;\n        }\n\n        if (vote.voterID === props.myUID) {\n          myVote.push(vote);\n        }\n      });\n      points = likes - dislikes < 0 ? 0 : likes - dislikes;\n      setPoints(points);\n      setLikes(likes);\n      setDislikes(dislikes);\n      setMyVote(myVote.length > 0 ? myVote : []);\n    });\n    return () => {\n      votesListener();\n    };\n  }, [props.myUID, props.postSelected, props.viewedPost]);\n\n  const vote = newValue => {\n    const voter = document.getElementById('voter');\n    voter.classList.remove('show');\n    voter.classList.add('hide');\n    const db = firebase.firestore();\n\n    if (myVote.length === 0) {\n      var newVote = {\n        value: newValue,\n        date: new Date(),\n        pid: props.viewedPost.pid,\n        receiverID: props.viewedPost.uid,\n        voterID: props.myUID,\n        postDate: props.viewedPost.createdOn,\n        address: props.viewedPost.address\n      };\n      db.collection('postVotes').add(newVote).catch(err => console.log(err));\n    } else {\n      var updatedVote = _objectSpread({}, myVote[0], {\n        value: newValue === myVote[0].value ? 0 : newValue,\n        date: new Date() // set the vote \n\n      });\n\n      db.collection('postVotes').doc(myVote[0].vid).set(updatedVote).catch(err => console.log(err)); // cleanup leaked extras ***\n\n      if (myVote.length > 1) {\n        for (let i = 1; i < myVote.length; i++) {\n          db.collection('postVotes').doc(myVote[i].vid).delete().then(() => console.log('vote deleted successfully')).catch(err => console.log(err));\n        }\n      }\n    }\n  }; // render ~~~~~~~~~~~~~\n\n\n  const pointsPercentage = likes > 0 ? Math.floor(likes * 1.0 / (likes + dislikes * 1.0) * 100) : null;\n  console.log(myVote);\n  var iconColor = myVote && myVote[0] && myVote[0].value ? 'lit' : '';\n  var iconStyle = React.createElement(\"i\", {\n    className: \"fa fa-\".concat('fire', \" vote-icon-container__\", 'fire', \" \", iconColor),\n    id: \"icon\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133\n    },\n    __self: this\n  });\n\n  if (myVote && myVote[0] && myVote[0].value === -1) {\n    iconStyle = React.createElement(\"i\", {\n      className: \"fa fa-\".concat('trash', \" vote-icon-container__\", 'trash', \" \", iconColor),\n      id: \"icon\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    });\n  }\n\n  return React.createElement(\"div\", {\n    className: \"likes\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"vote-icon-container\",\n    id: \"vote-icon\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  }, iconStyle, React.createElement(\"div\", {\n    className: \"vote-icon-container-hover-div\",\n    onClick: myVote && myVote[0] && myVote[0].value === -1 ? () => vote(-1) : () => vote(1),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"vote-icon-container__pop-up-voter hide\",\n    id: \"voter\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"pop-up-voter__icon-wrapper left\",\n    onClick: () => vote(-1),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }, React.createElement(\"i\", {\n    className: \"fa fa-trash lit-trash voter-icon\",\n    \"aria-hidden\": \"true\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"pop-up-voter__icon-wrapper right\",\n    onClick: () => vote(1),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  }, React.createElement(\"i\", {\n    className: \"fa fa-fire lit voter-icon\",\n    \"aria-hidden\": \"true\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  })))), React.createElement(\"div\", {\n    className: \"total-score\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, points, \" pt\", points === 1 ? null : 's', \". \", pointsPercentage ? '(' + pointsPercentage + '%)' : null), React.createElement(\"div\", {\n    className: \"fans\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }, likes, \" \", likes === 1 ? 'like' : 'likes'));\n};\n\nconst mapStatetoProps = state => {\n  return {\n    myUID: state.uid\n  };\n};\n\nexport default connect(mapStatetoProps, null)(PostLikes);","map":{"version":3,"sources":["/Users/davidkang/Desktop/local-barz/src/containers/Scribble/MyBars/ViewedBar/PostLikes/PostLikes.js"],"names":["React","Component","useState","useEffect","connect","firebase","setTimeout","PostLikes","props","points","setPoints","likes","setLikes","dislikes","setDislikes","myVote","setMyVote","showTimeOut","window","clearTimeout","closeTimeout","openTimeout","voter","classList","add","remove","removeTimeOut","document","getElementById","voteIcon","addEventListener","db","firestore","votesListener","collection","where","viewedPost","pid","onSnapshot","snapshot","docs","forEach","vote","data","vid","id","value","voterID","myUID","push","length","postSelected","newValue","newVote","date","Date","receiverID","uid","postDate","createdOn","address","catch","err","console","log","updatedVote","doc","set","i","delete","then","pointsPercentage","Math","floor","iconColor","iconStyle","mapStatetoProps","state"],"mappings":"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","sourcesContent":["import React, { Component, useState, useEffect } from 'react'\nimport { connect } from 'react-redux'\nimport firebase from 'firebase'\nimport 'firebase/firestore'\n\n\nimport './PostLikes.css'\nimport { setTimeout } from 'timers'\n\nconst PostLikes = (props) => {\n\n\n    // data\n    const [points, setPoints] = useState(0);\n    const [likes, setLikes] = useState(0)\n    const [dislikes, setDislikes] = useState(0)\n    const [myVote, setMyVote] = useState(null)\n\n\n    useEffect(() => {\n\n        const showTimeOut = () => {\n            window.clearTimeout(closeTimeout)\n            openTimeout = window.setTimeout(function () {\n                voter.classList.add('show')\n                voter.classList.remove('hide')\n            }, 750);\n        }\n        const removeTimeOut = () => {\n            window.clearTimeout(openTimeout)\n            closeTimeout = window.setTimeout(function () {\n                voter.classList.remove('show')\n                voter.classList.add('hide')\n            }, 750)\n        }\n\n        var openTimeout = null;\n        var closeTimeout = null\n        const voter = document.getElementById('voter')\n        const voteIcon = document.getElementById('vote-icon')\n\n\n        voteIcon.addEventListener('mouseover', showTimeOut);\n        voter.addEventListener('mouseover', () => window.clearTimeout(closeTimeout));\n        voteIcon.addEventListener('mouseout', removeTimeOut);\n        return () => {\n\n        };\n    }, [])\n\n\n\n    useEffect(() => {\n\n        const db = firebase.firestore()\n        const votesListener = db.collection('postVotes').where('pid', '==', props.viewedPost.pid).onSnapshot(snapshot => {\n            var points = 0\n            var likes = 0\n            var dislikes = 0\n            var myVote = [];\n            // for every vote of this post\n            snapshot.docs.forEach(vote => {\n                vote = { ...vote.data(), vid: vote.id }\n                if (vote.value === 1) {\n                    likes += 1\n                }\n                if (vote.value === -1) {\n                    dislikes += 1\n                }\n                if (vote.voterID === props.myUID) {\n                    myVote.push(vote)\n                }\n            })\n            points = (likes - dislikes) < 0 ? 0 : (likes - dislikes)\n            setPoints(points)\n            setLikes(likes)\n            setDislikes(dislikes)\n            setMyVote(myVote.length > 0 ? myVote : [])\n        })\n        return () => {\n            votesListener()\n        };\n    }, [props.myUID, props.postSelected, props.viewedPost]);\n\n\n    const vote = (newValue) => {\n        const voter = document.getElementById('voter')\n        voter.classList.remove('show')\n        voter.classList.add('hide')\n        const db = firebase.firestore()\n        if (myVote.length === 0) {\n            var newVote = {\n                value: newValue,\n                date: new Date(),\n                pid: props.viewedPost.pid,\n                receiverID: props.viewedPost.uid,\n                voterID: props.myUID,\n                postDate: props.viewedPost.createdOn,\n                address: props.viewedPost.address\n            }\n            db.collection('postVotes').add(newVote)\n                .catch(err => console.log(err))\n        } else {\n            var updatedVote = {\n                ...myVote[0],\n                value: newValue === myVote[0].value ? 0 : newValue,\n                date: new Date()\n            }\n            // set the vote \n            db.collection('postVotes').doc(myVote[0].vid)\n                .set(updatedVote)\n                .catch(err => console.log(err))\n\n            // cleanup leaked extras ***\n            if (myVote.length > 1) {\n                for (let i = 1; i < myVote.length; i++) {\n                    db.collection('postVotes').doc(myVote[i].vid)\n                        .delete()\n                        .then(() => console.log('vote deleted successfully'))\n                        .catch(err => console.log(err))\n                }\n            }\n        }\n    }\n\n    // render ~~~~~~~~~~~~~\n\n\n    const pointsPercentage = likes > 0 ? Math.floor((likes * 1.0) / (likes + dislikes * 1.0) * 100) : null\n\n    console.log(myVote)\n    var iconColor = myVote && myVote[0] && myVote[0].value ? 'lit' : ''\n    var iconStyle = <i className={`fa fa-${'fire'} vote-icon-container__${'fire'} ${iconColor}`} id='icon'/>\n    if (myVote && myVote[0] && myVote[0].value === -1) {\n        iconStyle = <i className={`fa fa-${'trash'} vote-icon-container__${'trash'} ${iconColor}`} id='icon'/>\n    }\n\n    return (\n        <div className='likes'>\n            <div\n                className={`vote-icon-container`}\n                id={`vote-icon`}>\n                {iconStyle}\n                <div className={`vote-icon-container-hover-div`} onClick={myVote && myVote[0] && myVote[0].value === -1 ? () => vote(-1) : () => vote(1)}></div>\n                <div className={`vote-icon-container__pop-up-voter hide`} id={`voter`}>\n                    <div className={`pop-up-voter__icon-wrapper left`} onClick={() => vote(-1)}><i className={`fa fa-trash lit-trash voter-icon`} aria-hidden=\"true\"></i></div>\n                    <div className={`pop-up-voter__icon-wrapper right`} onClick={() => vote(1)}><i className={`fa fa-fire lit voter-icon`} aria-hidden=\"true\"></i></div>\n                </div>\n            </div>\n\n            <div className='total-score'>\n                {points} pt{points === 1 ? null : 's'}. {pointsPercentage ? '(' + pointsPercentage + '%)' : null}\n            </div>\n            <div className='fans'>\n                {likes} {likes === 1 ? 'like' : 'likes'}\n            </div>\n        </div>\n    )\n}\n\nconst mapStatetoProps = state => {\n    return {\n        myUID: state.uid\n    }\n}\n\nexport default connect(mapStatetoProps, null)(PostLikes)\n"]},"metadata":{},"sourceType":"module"}