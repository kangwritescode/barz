{"ast":null,"code":"import _defineProperty from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/davidkang/Desktop/local-barz/src/containers/Hub/DeleteAccount/DeleteAccount.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/*global FB*/\nimport React, { Component } from 'react';\nimport firebase from 'firebase';\nimport { connect } from 'react-redux';\nimport './DeleteAccount.css';\nimport trash from '../../../assets/images/trash.png';\nimport * as actionTypes from '../../../store/actions/actionsTypes';\nimport * as actions from '../../../store/actions/index';\nimport { errorCreater } from '../../../shared/utility';\n\nclass DeleteAccount extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      password: '',\n      spinning: true,\n      FBtoken: null,\n      authType: ''\n    };\n\n    this.componentDidMount = () => {\n      this.setSpinner(true);\n      FB.getLoginStatus(response => {\n        console.log(respose);\n\n        if (response.status === 'connected') {\n          var accessToken = response.authResponse.accessToken;\n          this.setAuthType('FB', accessToken);\n        } else if (response.status === 'not_authorized') {\n          this.setAuthType('FB', null);\n        } else {\n          this.setAuthType('PASSWORD', null);\n        }\n\n        this.setSpinner(false);\n      });\n    };\n\n    this.setAuthType = (authType, fbToken) => {\n      this.setState(_objectSpread({}, this.state, {\n        authType: authType,\n        FBtoken: fbToken\n      }));\n    };\n\n    this.setSpinner = bool => {\n      this.setState(_objectSpread({}, this.state, {\n        spinning: bool\n      }));\n    };\n\n    this.onInputHandler = event => {\n      this.setState(_objectSpread({}, this.state, {\n        password: event.target.value\n      }));\n    };\n\n    this.deleteAccount = async () => {\n      let user = firebase.auth().currentUser;\n      let credentials = null; // get the appropriate credentials\n\n      try {\n        if (this.state.authType === 'PASSWORD') {\n          credentials = firebase.auth.EmailAuthProvider.credential(user.email, this.state.password);\n        } else if (this.state.FBtoken) {\n          credentials = firebase.auth.FacebookAuthProvider.credential(this.state.FBtoken);\n        } else {\n          throw errorCreater('Facebook Auth token has expired. Log out and back in to delete account.');\n        }\n      } catch (err) {\n        console.log(err.message);\n        this.setSpinner(false);\n        return;\n      } // first reauthenticate\n\n\n      user.reauthenticateWithCredential(credentials).then(async () => {\n        let db = firebase.firestore(); // delete submissions\n\n        await db.collection(\"submissions\").get().then(snapshot => {\n          snapshot.forEach(doc => {\n            let post = doc.data();\n\n            if (post.uid === this.props.uid) {\n              doc.ref.delete();\n            }\n          });\n        }).catch(err => {\n          throw err;\n        }); // delete follows\n\n        await db.collection(\"follows\").get().then(snapshot => {\n          snapshot.forEach(doc => {\n            let follow = doc.data();\n\n            if (follow.from === this.props.uid || follow.to === this.props.uid) {\n              doc.ref.delete();\n            }\n          });\n        }).catch(err => {\n          throw err;\n        }); // delete votes\n\n        await db.collection(\"postVotes\").get().then(snapshot => {\n          snapshot.forEach(doc => {\n            let vote = doc.data();\n\n            if (vote.receiverID === this.props.uid || vote.voterID === this.props.uid) {\n              doc.ref.delete();\n            }\n          });\n        }).catch(err => {\n          throw err;\n        }); // delete post comments\n\n        await db.collection(\"postComments\").get().then(querySnapshot => {\n          querySnapshot.forEach(doc => {\n            let comment = doc.data();\n\n            if (comment.uid === this.props.uid || comment.receiverUID === this.props.uid) {\n              doc.ref.delete();\n            }\n          });\n        }).catch(err => {\n          throw err;\n        }); //  remove profile image\n\n        let storage = firebase.storage();\n        let storageRef = storage.ref();\n        let imgRef = storageRef.child(\"images/\".concat(this.props.uid, \"/userIMG.png\"));\n        await imgRef.delete().then(() => console.log('profile image deleted successfully')).catch(err => {\n          throw err;\n        }); // delete the user\n\n        await db.collection('users').doc(\"\".concat(this.props.uid)).delete().then(() => {\n          console.log('user deleted successfully');\n        }).catch(err => {\n          throw err;\n        }); // delete auth acount\n\n        await firebase.auth().currentUser.delete().then(res => console.log('ACCOUNT WAS DELETED!!!!!')).catch(err => {\n          throw err;\n        });\n        this.props.logout();\n      }).catch(err => console.log(err.message));\n    };\n  }\n\n  render() {\n    var deletePrompt;\n\n    if (this.state.authType === 'FB') {\n      deletePrompt = \"Type 'goodbye' and press 'Delete'.\";\n    } else {\n      deletePrompt = 'All user data will be deleted forever.';\n    }\n\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"delete-backdrop\",\n      onClick: () => this.props.toggleDeleteAcc(false),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"delete-account-modal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"fa fa-close\",\n      id: \"exit-delete-modal\",\n      onClick: () => this.props.toggleDeleteAcc(false),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }), React.createElement(\"img\", {\n      id: \"delete-icon\",\n      src: trash,\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"are-you-sure\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }, \"Delete Account\"), React.createElement(\"div\", {\n      id: \"will-be-deleted\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, deletePrompt), React.createElement(\"input\", {\n      type: \"password\",\n      id: \"delete-pass-input\",\n      placeholder: this.state.authType === 'FB' ? '' : 'password',\n      onChange: this.onInputHandler,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"delete-buttons\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"delete-button\",\n      id: \"cancel\",\n      onClick: () => this.props.toggleDeleteAcc(false),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, \"Cancel\"), React.createElement(\"div\", {\n      className: \"delete-button\",\n      id: this.state.password === '' ? 'delete-disabled' : 'delete',\n      onClick: this.state.password === '' ? null : this.deleteAccount,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }, \"Delete\"))));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    uid: state.user.uid\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    logout: () => dispatch(actions.logOut())\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DeleteAccount);","map":{"version":3,"sources":["/Users/davidkang/Desktop/local-barz/src/containers/Hub/DeleteAccount/DeleteAccount.js"],"names":["React","Component","firebase","connect","trash","actionTypes","actions","errorCreater","DeleteAccount","state","password","spinning","FBtoken","authType","componentDidMount","setSpinner","FB","getLoginStatus","response","console","log","respose","status","accessToken","authResponse","setAuthType","fbToken","setState","bool","onInputHandler","event","target","value","deleteAccount","user","auth","currentUser","credentials","EmailAuthProvider","credential","email","FacebookAuthProvider","err","message","reauthenticateWithCredential","then","db","firestore","collection","get","snapshot","forEach","doc","post","data","uid","props","ref","delete","catch","follow","from","to","vote","receiverID","voterID","querySnapshot","comment","receiverUID","storage","storageRef","imgRef","child","res","logout","render","deletePrompt","toggleDeleteAcc","mapStateToProps","mapDispatchToProps","dispatch","logOut"],"mappings":"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","sourcesContent":["/*global FB*/\n\nimport React, { Component } from 'react'\nimport firebase from 'firebase'\nimport { connect } from 'react-redux'\nimport './DeleteAccount.css'\nimport trash from '../../../assets/images/trash.png'\nimport * as actionTypes from '../../../store/actions/actionsTypes'\nimport * as actions from '../../../store/actions/index'\nimport { errorCreater } from '../../../shared/utility'\n\nclass DeleteAccount extends Component {\n\n    state = {\n        password: '',\n        spinning: true,\n        FBtoken: null,\n        authType: ''\n    }\n\n    componentDidMount = () => {\n        this.setSpinner(true)\n        FB.getLoginStatus((response) => {\n            console.log(respose)\n            if (response.status === 'connected') {\n                var accessToken = response.authResponse.accessToken;\n                this.setAuthType('FB', accessToken)\n            } else if (response.status === 'not_authorized') {\n                this.setAuthType('FB', null)\n            } else {\n                this.setAuthType('PASSWORD', null)\n            }\n            this.setSpinner(false)\n        });\n    }\n    setAuthType = (authType, fbToken) => {\n        this.setState({\n            ...this.state,\n            authType: authType,\n            FBtoken: fbToken\n        })\n\n    }\n    setSpinner = bool => {\n        this.setState({\n            ...this.state,\n            spinning: bool\n        })\n    }\n\n    onInputHandler = (event) => {\n        this.setState({\n            ...this.state,\n            password: event.target.value\n        })\n    }\n\n\n    deleteAccount = async () => {\n        let user = firebase.auth().currentUser;\n        let credentials = null;\n        // get the appropriate credentials\n        try {\n            if (this.state.authType === 'PASSWORD') {\n                credentials = firebase.auth.EmailAuthProvider.credential(\n                    user.email,\n                    this.state.password\n                );\n            } else if (this.state.FBtoken) {\n                credentials = firebase.auth.FacebookAuthProvider.credential(this.state.FBtoken);\n            } else {\n                throw errorCreater('Facebook Auth token has expired. Log out and back in to delete account.')\n            }\n        } catch (err) {\n            console.log(err.message)\n            this.setSpinner(false)\n            return\n        }\n\n        // first reauthenticate\n        user.reauthenticateWithCredential(credentials)\n            .then(async () => {\n                let db = firebase.firestore()\n\n                // delete submissions\n                await db.collection(\"submissions\").get().then(snapshot => {\n                    snapshot.forEach(doc => {\n                        let post = doc.data()\n                        if (post.uid === this.props.uid) {\n                            doc.ref.delete()\n                        }\n                    })\n                }).catch(err => { throw err })\n\n                // delete follows\n                await db.collection(\"follows\").get().then(snapshot => {\n                    snapshot.forEach(doc => {\n                        let follow = doc.data()\n                        if (follow.from === this.props.uid\n                            || follow.to === this.props.uid) {\n                            doc.ref.delete()\n                        }\n                    })\n                }).catch(err => { throw err })\n\n\n                // delete votes\n                await db.collection(\"postVotes\").get().then(snapshot => {\n                    snapshot.forEach(doc => {\n                        let vote = doc.data()\n                        if (vote.receiverID === this.props.uid\n                            || vote.voterID === this.props.uid) {\n                            doc.ref.delete()\n                        }\n                    })\n                }).catch(err => { throw err })\n\n                // delete post comments\n                await db.collection(\"postComments\").get().then(querySnapshot => {\n                    querySnapshot.forEach(doc => {\n\n                        let comment = doc.data()\n                        if (comment.uid === this.props.uid\n                            || comment.receiverUID === this.props.uid) {\n                            doc.ref.delete()\n                        }\n\n                    })\n                }).catch(err => { throw err })\n\n\n\n                //  remove profile image\n                let storage = firebase.storage();\n                let storageRef = storage.ref();\n                let imgRef = storageRef.child(`images/${this.props.uid}/userIMG.png`)\n                await imgRef.delete()\n                    .then(() => console.log('profile image deleted successfully'))\n                    .catch((err) => { throw err })\n\n                // delete the user\n                await db.collection('users').doc(`${this.props.uid}`).delete()\n                    .then(() => { console.log('user deleted successfully') })\n                    .catch(err => { throw err })\n\n                // delete auth acount\n                await firebase.auth().currentUser.delete()\n                    .then(res => console.log('ACCOUNT WAS DELETED!!!!!'))\n                    .catch(err => { throw err })\n\n                this.props.logout()\n\n            })\n            .catch(err => console.log(err.message))\n\n    }\n\n\n    render() {\n\n        var deletePrompt;\n        if (this.state.authType === 'FB') {\n            deletePrompt = \"Type 'goodbye' and press 'Delete'.\"\n        }\n        else {\n            deletePrompt = 'All user data will be deleted forever.'\n        }\n        return (\n            <div>\n                <div className=\"delete-backdrop\" onClick={() => this.props.toggleDeleteAcc(false)} />\n                <div id=\"delete-account-modal\">\n                    <i className=\"fa fa-close\" id=\"exit-delete-modal\" onClick={() => this.props.toggleDeleteAcc(false)}></i>\n                    <img id=\"delete-icon\" src={trash} alt=''></img>\n                    <div id=\"are-you-sure\">Delete Account</div>\n                    <div id=\"will-be-deleted\">\n                        {deletePrompt}\n                    </div>\n                    <input type=\"password\" id=\"delete-pass-input\" placeholder={this.state.authType === 'FB' ? '' : 'password'} onChange={this.onInputHandler}></input>\n                    <div id=\"delete-buttons\">\n                        <div className=\"delete-button\" id=\"cancel\" onClick={() => this.props.toggleDeleteAcc(false)}>Cancel</div>\n                        <div\n                            className={`delete-button`}\n                            id={this.state.password === '' ? 'delete-disabled' : 'delete'} onClick={this.state.password === '' ? null : this.deleteAccount}>Delete</div>\n                    </div>\n                </div>\n            </div>\n\n        )\n    }\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        uid: state.user.uid\n    }\n}\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        logout: () => dispatch(actions.logOut())\n    }\n}\n\n\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DeleteAccount);\n"]},"metadata":{},"sourceType":"module"}