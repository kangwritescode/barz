{"ast":null,"code":"import * as actionTypes from './actionsTypes';\nimport firebase from '../../Firebase';\nimport 'firebase/firestore';\nlet db = firebase.firestore();\nexport const fetchUserData = uid => {\n  return dispatch => {\n    let docRef = db.collection(\"users/\").doc(uid);\n    docRef.get().then(doc => {\n      if (doc.exists) {\n        dispatch(setUserData(doc.data()));\n      } else {\n        dispatch(logOut());\n      }\n    }).catch(function (error) {\n      dispatch(logOut());\n      console.log(\"Error getting document:\", error);\n    });\n  };\n};\nexport const setUserData = data => {\n  return {\n    type: actionTypes.SET_USER_DATA,\n    data: data\n  };\n};\nexport const postUserData = (uid, newInfo, setSpinner) => {\n  return dispatch => {\n    db.collection(\"users\").doc(uid).update(newInfo).then(function () {\n      console.log('post user data update success');\n\n      if (setSpinner) {\n        setSpinner(false);\n      }\n\n      console.log(newInfo);\n      dispatch(setUserData(newInfo));\n    }).catch(function (error) {\n      if (setSpinner) {\n        setSpinner(false);\n      }\n\n      console.error(\"Error updating document: \", error);\n    });\n  };\n};\nexport const authCheckState = () => {\n  return dispatch => {\n    const token = localStorage.getItem('token');\n\n    if (!token) {\n      firebase.auth().signOut();\n      dispatch(logOut());\n    } else {\n      const expirationTime = new Date(localStorage.getItem('expirationDate'));\n\n      if (expirationTime < new Date()) {\n        firebase.auth().signOut();\n        dispatch(logOut());\n      } else {\n        const uid = localStorage.getItem('uid');\n        dispatch(fetchUserData(uid));\n      }\n    }\n  };\n};\nexport const logOut = () => {\n  return {\n    type: actionTypes.LOG_OUT\n  };\n};","map":{"version":3,"sources":["/Users/davidkang/Documents/GitHub/barz/src/store/actions/auth.js"],"names":["actionTypes","firebase","db","firestore","fetchUserData","uid","dispatch","docRef","collection","doc","get","then","exists","setUserData","data","logOut","catch","error","console","log","type","SET_USER_DATA","postUserData","newInfo","setSpinner","update","authCheckState","token","localStorage","getItem","auth","signOut","expirationTime","Date","LOG_OUT"],"mappings":"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","sourcesContent":["\nimport * as actionTypes from './actionsTypes'\nimport firebase from '../../Firebase'\nimport 'firebase/firestore'\nlet db = firebase.firestore()\n\nexport const fetchUserData = (uid) => {\n    return dispatch => {\n        let docRef = db.collection(`users/`).doc(uid);\n        docRef.get().then((doc) => {\n            if (doc.exists) {\n                dispatch(setUserData(doc.data()))\n            } else {\n                dispatch(logOut())\n            }\n        }).catch(function (error) {\n            dispatch(logOut())\n            console.log(\"Error getting document:\", error);\n        });\n    }\n}\n\nexport const setUserData = (data) => {\n    return {\n        type: actionTypes.SET_USER_DATA, data: data\n    }\n}\n\nexport const postUserData = (uid, newInfo, setSpinner) => {\n    return dispatch => {\n        db.collection(\"users\").doc(uid).update(newInfo)\n            .then(function () {\n                console.log('post user data update success')\n                if (setSpinner) {\n                    setSpinner(false)\n                }\n                console.log(newInfo)\n                dispatch(setUserData(newInfo))\n            })\n            .catch(function (error) {\n                if (setSpinner) {\n                    setSpinner(false)\n                }\n                console.error(\"Error updating document: \", error);\n            });\n    }\n}\n\nexport const authCheckState = () => {\n    return dispatch => {\n        const token = localStorage.getItem('token')\n        if (!token) {\n            firebase.auth().signOut()\n            dispatch(logOut())\n        } else {\n            const expirationTime = new Date(localStorage.getItem('expirationDate'))\n            if (expirationTime < new Date()) {\n                firebase.auth().signOut()\n                dispatch(logOut())\n            } else {\n                const uid = localStorage.getItem('uid')\n                dispatch(fetchUserData(uid))\n            }\n        }\n    }\n}\n\nexport const logOut = () => {\n    return {\n        type: actionTypes.LOG_OUT\n    }\n}\n\n"]},"metadata":{},"sourceType":"module"}