{"ast":null,"code":"import _defineProperty from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/davidkang/Desktop/local-barz/src/containers/Landing/RegForm/RegForm.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport validator from 'validator';\nimport firebase from 'firebase';\nimport { regions } from '../../../shared/regions';\nimport './RegForm.css';\nimport axios from 'axios';\nimport { errorCreater } from '../../../shared/errorCreator';\n\nfunction RegForm(props) {\n  // State\n  // data \n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      allEmails = _useState2[0],\n      setAllEmails = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      allUsernames = _useState4[0],\n      setAllUsernames = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      mysteryManBlob = _useState6[0],\n      setMysteryManBlob = _useState6[1]; // ui\n\n\n  var _useState7 = useState('account'),\n      _useState8 = _slicedToArray(_useState7, 2),\n      step = _useState8[0],\n      setStep = _useState8[1];\n\n  var _useState9 = useState('false'),\n      _useState10 = _slicedToArray(_useState9, 2),\n      spinning = _useState10[0],\n      setSpinner = _useState10[1]; //profile\n\n\n  var _useState11 = useState(''),\n      _useState12 = _slicedToArray(_useState11, 2),\n      email = _useState12[0],\n      setEmail = _useState12[1];\n\n  var _useState13 = useState(''),\n      _useState14 = _slicedToArray(_useState13, 2),\n      password = _useState14[0],\n      setPass = _useState14[1];\n\n  var _useState15 = useState(''),\n      _useState16 = _slicedToArray(_useState15, 2),\n      username = _useState16[0],\n      setUsername = _useState16[1];\n\n  var _useState17 = useState(''),\n      _useState18 = _slicedToArray(_useState17, 2),\n      zipcode = _useState18[0],\n      setZipcode = _useState18[1];\n\n  var _useState19 = useState(''),\n      _useState20 = _slicedToArray(_useState19, 2),\n      gender = _useState20[0],\n      pickGender = _useState20[1]; // on mounting\n\n\n  useEffect(() => {\n    fetchEmailsAndUsernames();\n    fetchMysteryMan();\n  }, []); // api calls\n\n  const fetchEmailsAndUsernames = async () => {\n    const db = firebase.firestore();\n    var emailsAndUsernames = await db.collection('users').get().then(snapshots => {\n      var emails = [];\n      var usernames = [];\n      snapshots.forEach(snapshot => {\n        emails.push(snapshot.data().email);\n        usernames.push(snapshot.data().username);\n      });\n      return [emails, usernames];\n    });\n    setAllEmails(emailsAndUsernames[0]);\n    setAllUsernames(emailsAndUsernames[1]);\n  };\n\n  const fetchAddressFromZipcode = async zipcode => {\n    return axios.get('https://www.zipcodeapi.com/rest/js-zF10dQxfazt7cMgYnzZphQk7jEzBwBYPb781ubkqZokAXEvUzbinxdGT5rzVrkmB/info.json/' + zipcode + '/degrees').then(res => {\n      return res.data;\n    }).catch(err => {\n      throw errorCreater(\"Sorry, we're having trouble processing that ZIP Code.\");\n    });\n  };\n\n  const createAuthUser = async (userInput, password) => {\n    return firebase.auth().createUserWithEmailAndPassword(userInput, password).then(authObj => {\n      return [authObj.user.email, authObj.user.uid];\n    }).catch(err => {\n      throw err;\n    });\n  };\n\n  const uploadMysteryMan = async uid => {\n    var storageRef = firebase.storage().ref();\n    var photoRef = storageRef.child(\"images/\".concat(uid, \"/userIMG.png\"));\n    return photoRef.put(mysteryManBlob).then(() => {\n      return photoRef;\n    }).catch(err => {\n      console.log(err.message);\n    });\n  };\n\n  const fetchMysteryMan = () => {\n    var storage = firebase.storage();\n    storage.ref('mysteryman/mysteryman.png').getDownloadURL().then(url => {\n      var xhr = new XMLHttpRequest();\n      xhr.responseType = 'blob';\n\n      xhr.onload = event => {\n        var blob = xhr.response;\n        setMysteryManBlob(blob);\n      };\n\n      xhr.open('GET', url);\n      xhr.send();\n    }).catch(function (error) {\n      console.log(error);\n    });\n  };\n\n  const createFirebaseUser = async (email, uid, address, photoRef) => {\n    var db = firebase.firestore();\n    const user = {\n      email: email,\n      uid: uid,\n      photoRef: photoRef,\n      username: username,\n      address: _objectSpread({}, address, {\n        region: regions[address[\"state\"]]\n      }),\n      gender: gender,\n      handles: {\n        facebook: '',\n        instagram: '',\n        soundcloud: '',\n        youtube: ''\n      }\n    };\n    return db.collection('users').doc(uid).set(user).then(() => {\n      return true;\n    }).catch(err => {\n      throw err;\n    });\n  }; // filter functions\n\n\n  const filterAndSetUsername = value => {\n    const regex = new RegExp(/^[A-Za-z0-9_]+$/);\n\n    if (regex.test(value) || value === '') {\n      setUsername(value);\n    } else {\n      return;\n    }\n  };\n\n  const filterAndSetZipcode = value => {\n    if (value.length <= 5) {\n      setZipcode(value);\n    }\n  }; // validate functions\n\n\n  const validateEmail = email => {\n    if (!validator.isEmail(email)) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const validatePassword = password => {\n    if (password.length < 6) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const validateUsername = username => {\n    if (username.length < 3) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const validateZipcode = zipcode => {\n    var zipString = parseInt(zipcode);\n    var zipCodePattern = /^\\d{5}$|^\\d{5}-\\d{4}$/;\n    return zipCodePattern.test(zipString);\n  }; // auth functions\n\n\n  const firstStep = async () => {\n    try {\n      await fetchEmailsAndUsernames();\n\n      if (allEmails.includes(email)) {\n        throw errorCreater('The email address is already in use by another account.');\n      } else {\n        setStep('profile');\n      }\n    } catch (err) {\n      notifyWithErr(err.message);\n    }\n  };\n\n  const submit = async event => {\n    event.preventDefault();\n\n    try {\n      // username check\n      await fetchEmailsAndUsernames();\n\n      if (allUsernames.includes(username)) {\n        throw errorCreater('That username is taken.');\n      }\n\n      if (allEmails.includes(email)) {\n        throw errorCreater('The email address is already in use by another account.');\n      } // zipcode check\n\n\n      const address = await fetchAddressFromZipcode(zipcode);\n\n      let _ref = await createAuthUser(email, password),\n          _ref2 = _slicedToArray(_ref, 2),\n          emailFire = _ref2[0],\n          uid = _ref2[1];\n\n      const photoRef = await uploadMysteryMan(uid);\n      await createFirebaseUser(emailFire, uid, address, photoRef.location.path);\n      props.setErrSentiment(true);\n      notifyWithErr('Profile Created Successfully!');\n    } catch (err) {\n      notifyWithErr(err.message);\n    }\n  };\n\n  const notifyWithErr = msg => {\n    props.setErrMsg(msg);\n    props.setShowErr(true);\n  }; // validate values (account)\n\n\n  const isInvalidEmail = email && !validateEmail(email) ? 'invalid' : null;\n  const isInvalidPass = password && !validatePassword(password) ? 'invalid' : null;\n  const isValidContinue = email && password && !isInvalidEmail && !isInvalidPass ? 'valid' : null; // validate values (profile)\n\n  const isInvalidUsername = username && !validateUsername(username) ? 'invalid' : null;\n  const isInvalidZipcode = zipcode && !validateZipcode(zipcode) ? 'invalid' : null;\n  const maleSelected = gender === 'Male' ? 'focused-sex' : null;\n  const femaleSelected = gender === 'Female' ? 'focused-sex' : null;\n  const isValidSubmit = username && zipcode && gender && validateUsername(username) && validateZipcode(zipcode) ? 'valid' : null; // form\n\n  var form = React.createElement(\"div\", {\n    className: \"account-wrapper\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"reg-detail\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241\n    },\n    __self: this\n  }, \"Account Info\"), React.createElement(\"input\", {\n    className: \"large-input \".concat(isInvalidEmail),\n    placeholder: \"Email\",\n    value: email,\n    onChange: event => setEmail(event.target.value),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242\n    },\n    __self: this\n  }), React.createElement(\"input\", {\n    className: \"large-input \".concat(isInvalidPass),\n    type: \"password\",\n    value: password,\n    placeholder: \"Password\",\n    onChange: event => setPass(event.target.value),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247\n    },\n    __self: this\n  }), React.createElement(\"button\", {\n    className: \"reg-button \".concat(isValidContinue),\n    onClick: event => {\n      event.preventDefault();\n      firstStep();\n    },\n    disabled: !isValidContinue,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253\n    },\n    __self: this\n  }, \"Continue\"));\n\n  if (step === 'profile') {\n    form = React.createElement(\"div\", {\n      className: \"profile-wrapper\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"fas fa-chevron-left\",\n      id: \"reg-form-back\",\n      onClick: () => setStep('account'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"reg-detail\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267\n      },\n      __self: this\n    }, \"Profile Info\"), React.createElement(\"input\", {\n      className: \"large-input \".concat(isInvalidUsername),\n      placeholder: \"Username\",\n      value: username,\n      maxLength: 15,\n      onChange: event => filterAndSetUsername(event.target.value),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"zip-sex-wrapper\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"number\",\n      className: \"zip-input \".concat(isInvalidZipcode),\n      placeholder: \"Hometown ZIP\",\n      value: zipcode,\n      onChange: event => filterAndSetZipcode(event.target.value),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"sex-button \".concat(maleSelected),\n      onClick: event => {\n        event.preventDefault();\n        pickGender('Male');\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281\n      },\n      __self: this\n    }, \"M\"), React.createElement(\"button\", {\n      className: \"sex-button \".concat(femaleSelected),\n      onClick: event => {\n        event.preventDefault();\n        pickGender('Female');\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282\n      },\n      __self: this\n    }, \"F\")), React.createElement(\"button\", {\n      className: \"reg-button \".concat(isValidSubmit),\n      onClick: event => submit(event, email),\n      disabled: !isValidSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284\n      },\n      __self: this\n    }, \"Submit\"));\n  }\n\n  return React.createElement(\"form\", {\n    className: \"reg-form\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292\n    },\n    __self: this\n  }, spinning ? React.createElement(\"div\", {\n    className: \"reg-form-spinner\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293\n    },\n    __self: this\n  }) : null, React.createElement(\"i\", {\n    className: \"fa fa-close\",\n    id: \"reg-form-close\",\n    onClick: () => {\n      props.updateReg(false);\n      props.setShowErr(false);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 294\n    },\n    __self: this\n  }), React.createElement(\"h1\", {\n    className: \"reg-header\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295\n    },\n    __self: this\n  }, \"Sign Up\"), form);\n}\n\nexport default RegForm;","map":{"version":3,"sources":["/Users/davidkang/Desktop/local-barz/src/containers/Landing/RegForm/RegForm.js"],"names":["React","useState","useEffect","validator","firebase","regions","axios","errorCreater","RegForm","props","allEmails","setAllEmails","allUsernames","setAllUsernames","mysteryManBlob","setMysteryManBlob","step","setStep","spinning","setSpinner","email","setEmail","password","setPass","username","setUsername","zipcode","setZipcode","gender","pickGender","fetchEmailsAndUsernames","fetchMysteryMan","db","firestore","emailsAndUsernames","collection","get","then","snapshots","emails","usernames","forEach","snapshot","push","data","fetchAddressFromZipcode","res","catch","err","createAuthUser","userInput","auth","createUserWithEmailAndPassword","authObj","user","uid","uploadMysteryMan","storageRef","storage","ref","photoRef","child","put","console","log","message","getDownloadURL","url","xhr","XMLHttpRequest","responseType","onload","event","blob","response","open","send","error","createFirebaseUser","address","region","handles","facebook","instagram","soundcloud","youtube","doc","set","filterAndSetUsername","value","regex","RegExp","test","filterAndSetZipcode","length","validateEmail","isEmail","validatePassword","validateUsername","validateZipcode","zipString","parseInt","zipCodePattern","firstStep","includes","notifyWithErr","submit","preventDefault","emailFire","location","path","setErrSentiment","msg","setErrMsg","setShowErr","isInvalidEmail","isInvalidPass","isValidContinue","isInvalidUsername","isInvalidZipcode","maleSelected","femaleSelected","isValidSubmit","form","target","updateReg"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport validator from 'validator'\nimport firebase from 'firebase'\nimport {regions} from '../../../shared/regions'\nimport './RegForm.css'\nimport axios from 'axios'\nimport { errorCreater } from '../../../shared/errorCreator'\n\nfunction RegForm(props) {\n\n    // State\n\n    // data \n    var [allEmails, setAllEmails] = useState([])\n    var [allUsernames, setAllUsernames] = useState([])\n    var [mysteryManBlob, setMysteryManBlob] = useState(null)\n\n    // ui\n    var [step, setStep] = useState('account')\n    var [spinning, setSpinner] = useState('false')\n\n    //profile\n    var [email, setEmail] = useState('')\n    var [password, setPass] = useState('')\n    var [username, setUsername] = useState('')\n    var [zipcode, setZipcode] = useState('')\n    var [gender, pickGender] = useState('')\n\n   \n\n    \n\n    // on mounting\n    useEffect(() => {\n        fetchEmailsAndUsernames()\n        fetchMysteryMan()\n    }, [])\n\n    // api calls\n    const fetchEmailsAndUsernames = async () => {\n        const db = firebase.firestore()\n        var emailsAndUsernames = await db.collection('users').get()\n            .then(snapshots => {\n                var emails = []\n                var usernames = []\n                snapshots.forEach(snapshot => {\n                    emails.push(snapshot.data().email)\n                    usernames.push(snapshot.data().username)\n                })\n                return [emails, usernames]\n            })\n        setAllEmails(emailsAndUsernames[0])\n        setAllUsernames(emailsAndUsernames[1])\n    }\n\n    const fetchAddressFromZipcode = async (zipcode) => {\n        return axios.get('https://www.zipcodeapi.com/rest/js-zF10dQxfazt7cMgYnzZphQk7jEzBwBYPb781ubkqZokAXEvUzbinxdGT5rzVrkmB/info.json/' + zipcode + '/degrees')\n            .then(res => { return res.data })\n            .catch(err => {\n                throw errorCreater(\"Sorry, we're having trouble processing that ZIP Code.\")\n            })\n    }\n    const createAuthUser = async (userInput, password) => {\n        return firebase.auth().createUserWithEmailAndPassword(userInput, password)\n            .then(authObj => {\n                return [authObj.user.email, authObj.user.uid]\n            })\n            .catch(err => {\n\n                throw err\n            })\n    }\n    const uploadMysteryMan = async (uid) => {\n        var storageRef = firebase.storage().ref();\n        var photoRef = storageRef.child(`images/${uid}/userIMG.png`);\n        return photoRef.put(mysteryManBlob)\n            .then(() => { return photoRef })\n            .catch(err => { console.log(err.message) })\n    }\n\n    const fetchMysteryMan = () => {\n        var storage = firebase.storage()\n        storage.ref('mysteryman/mysteryman.png').getDownloadURL()\n            .then(url => {\n                var xhr = new XMLHttpRequest();\n                xhr.responseType = 'blob';\n                xhr.onload = event => {\n                    var blob = xhr.response;\n                    setMysteryManBlob(blob)\n                };\n                xhr.open('GET', url);\n                xhr.send();\n\n            }).catch(function (error) {\n                console.log(error)\n            });\n    }\n    const createFirebaseUser = async (email, uid, address, photoRef) => {\n        var db = firebase.firestore();\n\n        const user = {\n            email: email,\n            uid: uid,\n            photoRef: photoRef,\n            username: username,\n            address: {\n                ...address,\n                region: regions[address[\"state\"]]\n            },\n            gender: gender,\n            handles: {\n                facebook: '',\n                instagram: '',\n                soundcloud: '',\n                youtube: ''\n            }\n        }\n        return db.collection('users').doc(uid).set(user)\n            .then(() => {\n                return true\n            })\n            .catch((err) => {\n                throw err\n            });\n    }\n\n\n\n    // filter functions\n    const filterAndSetUsername = (value) => {\n        const regex = new RegExp(/^[A-Za-z0-9_]+$/)\n        if (regex.test(value) || value === '') {\n            setUsername(value)\n        } else {\n            return\n        }\n    }\n\n    const filterAndSetZipcode = (value) => {\n        if (value.length <= 5) {\n            setZipcode(value)\n        }\n    }\n\n    // validate functions\n    const validateEmail = (email) => {\n        if (!validator.isEmail(email)) {\n            return false\n        }\n        return true\n    }\n    const validatePassword = (password) => {\n        if (password.length < 6) {\n            return false\n        }\n        return true\n    }\n    const validateUsername = (username) => {\n        if (username.length < 3) {\n            return false\n        }\n        return true\n    }\n\n    const validateZipcode = (zipcode) => {\n        var zipString = parseInt(zipcode)\n        var zipCodePattern = /^\\d{5}$|^\\d{5}-\\d{4}$/;\n        return zipCodePattern.test(zipString);\n    }\n\n    // auth functions\n    const firstStep = async () => {\n        try {\n            await fetchEmailsAndUsernames()\n            if (allEmails.includes(email)) {\n                throw errorCreater('The email address is already in use by another account.')\n            } else {\n                setStep('profile')\n            }\n        }\n        \n        catch (err) {\n            notifyWithErr(err.message)\n        }\n    }\n    \n\n\n    const submit = async (event) => {\n        event.preventDefault()\n\n        try {\n            // username check\n            await fetchEmailsAndUsernames()\n            if (allUsernames.includes(username)) {\n                throw errorCreater('That username is taken.')\n            }\n            if (allEmails.includes(email)) {\n                throw errorCreater('The email address is already in use by another account.')\n            }\n            // zipcode check\n            const address = await fetchAddressFromZipcode(zipcode)\n            let [emailFire, uid] = await createAuthUser(email, password)\n            const photoRef = await uploadMysteryMan(uid)\n            await createFirebaseUser(emailFire, uid, address, photoRef.location.path)\n            props.setErrSentiment(true)\n            notifyWithErr('Profile Created Successfully!')\n        }\n        catch (err) {\n            notifyWithErr(err.message)\n        }\n    }\n    const notifyWithErr = (msg) => {\n        props.setErrMsg(msg)\n        props.setShowErr(true)\n    }\n\n    // validate values (account)\n    const isInvalidEmail = email && !validateEmail(email) ? 'invalid' : null\n    const isInvalidPass = password && !validatePassword(password) ? 'invalid' : null\n    const isValidContinue = email && password && !isInvalidEmail && !isInvalidPass ? 'valid' : null\n\n\n    // validate values (profile)\n    const isInvalidUsername = username && !validateUsername(username) ? 'invalid' : null\n    const isInvalidZipcode = zipcode && !validateZipcode(zipcode) ? 'invalid' : null\n    const maleSelected = gender === 'Male' ? 'focused-sex' : null\n    const femaleSelected = gender === 'Female' ? 'focused-sex' : null\n    const isValidSubmit = (\n        username &&\n        zipcode &&\n        gender &&\n        validateUsername(username) &&\n        validateZipcode(zipcode)\n    ) ? 'valid' : null\n\n\n    // form\n    var form = (\n        <div className={`account-wrapper`}>\n            <div className='reg-detail'>Account Info</div>\n            <input\n                className={`large-input ${isInvalidEmail}`}\n                placeholder='Email'\n                value={email}\n                onChange={event => setEmail(event.target.value)}></input>\n            <input\n                className={`large-input ${isInvalidPass}`}\n                type='password'\n                value={password}\n                placeholder='Password'\n                onChange={event => setPass(event.target.value)}></input>\n            <button\n                className={`reg-button ${isValidContinue}`}\n                onClick={(event) => {\n                    event.preventDefault();\n                    firstStep()\n                }}\n                disabled={!isValidContinue}>Continue</button>\n        </div>\n\n    )\n    if (step === 'profile') {\n        form = (\n            <div className={`profile-wrapper`}>\n                <i className=\"fas fa-chevron-left\" id='reg-form-back' onClick={() => setStep('account')}></i>\n                <div className='reg-detail'>Profile Info</div>\n                <input\n                    className={`large-input ${isInvalidUsername}`}\n                    placeholder='Username'\n                    value={username}\n                    maxLength={15}\n                    onChange={event => filterAndSetUsername(event.target.value)}></input>\n                <div className='zip-sex-wrapper'>\n                    <input\n                        type='number'\n                        className={`zip-input ${isInvalidZipcode}`}\n                        placeholder='Hometown ZIP'\n                        value={zipcode}\n                        onChange={event => filterAndSetZipcode(event.target.value)}></input>\n                    <button className={`sex-button ${maleSelected}`} onClick={(event) => { event.preventDefault(); pickGender('Male') }}>M</button>\n                    <button className={`sex-button ${femaleSelected}`} onClick={(event) => { event.preventDefault(); pickGender('Female') }}>F</button>\n                </div>\n                <button\n                    className={`reg-button ${isValidSubmit}`}\n                    onClick={event => submit(event, email)}\n                    disabled={!isValidSubmit}>Submit</button>\n            </div>\n        )\n    }\n    return (\n        <form className='reg-form'>\n            {spinning ? <div className='reg-form-spinner'></div> : null}\n            <i className=\"fa fa-close\" id='reg-form-close' onClick={() => {props.updateReg(false); props.setShowErr(false)}}></i>\n            <h1 className='reg-header'>Sign Up</h1>\n            {form}\n        </form>\n    )\n}\n\nexport default RegForm\n"]},"metadata":{},"sourceType":"module"}