{"ast":null,"code":"import _defineProperty from \"/Users/davidkang/Desktop/barz/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/davidkang/Desktop/barz/src/containers/Judge/JudgeBarz/SingleView/SingleView.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component } from 'react';\nimport './SingleView.css';\nimport firebase from 'firebase';\nimport 'firebase/firestore';\nimport { connect } from 'react-redux';\nimport shuffle from 'shuffle-array';\nimport * as actionTypes from '../../../../store/actions';\nimport FourBars from '../FourBars/FourBars';\n\nclass SingleView extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      submissions: [{\n        content: {\n          lineOne: '',\n          lineTwo: '',\n          lineThree: '',\n          lineFour: ''\n        }\n      }],\n      votes: {},\n      vote: {\n        value: 0\n      },\n      pointer: 0,\n      showBars: false,\n      showErrMsg: false,\n      errMsg: 'this is the default errMsg',\n      popInLeft: 'pop-in-left',\n      popInRight: 'pop-in-right',\n      vote: null,\n      sort: \"Newest\",\n      filter: \"All Posts\",\n      view: \"Explore\",\n      // ManyPost\n      showPost: false,\n      pid: ''\n    };\n\n    this.componentDidMount = async () => {\n      this.fetchSubmissions();\n      this.fetchVotes();\n      this.setState(_objectSpread({}, this.state, {\n        showBars: true\n      }));\n    };\n\n    this.fetchSubmissions = async () => {\n      var db = firebase.firestore();\n      var submissions = [];\n      return db.collection('submissions').get().then(querySnapshot => {\n        querySnapshot.forEach(doc => {\n          var post = _objectSpread({}, doc.data(), {\n            pid: doc.id\n          });\n\n          submissions.push(post);\n        });\n        console.log('yeeeehaw');\n        this.setState(_objectSpread({}, this.state, {\n          submissions: submissions\n        }));\n      }).catch(err => {\n        console.log(err);\n      });\n    };\n\n    this.fetchVotes = async () => {\n      var db = firebase.firestore();\n      const votes = {};\n      db.collection('postVotes').onSnapshot(querySnapshot => {\n        querySnapshot.forEach(doc => {\n          var vote = _objectSpread({}, doc.data());\n\n          votes[doc.id] = vote;\n        });\n        this.setState(_objectSpread({}, this.state, {\n          votes: votes\n        }));\n      }, err => {\n        console.log(err);\n      });\n    };\n\n    this.findVote = () => {\n      var submissions = [...this.state.submissions];\n      submissions = this.sort_submissions(submissions);\n      submissions = this.filter_submissions(submissions);\n      var currSub = submissions[this.state.pointer];\n\n      if (currSub) {\n        var votes = this.state.votes;\n\n        for (let key in votes) {\n          var vote = votes[key];\n\n          if (vote.pid === currSub.pid && vote.voterID === this.props.uid) {\n            return _objectSpread({}, vote, {\n              vid: key\n            });\n          }\n        }\n      } else {\n        return null;\n      }\n    };\n\n    this.sort_submissions = submissions => {\n      var submissions = [...submissions];\n\n      switch (this.props.sort) {\n        case 'Newest':\n          submissions = submissions.sort((a, b) => {\n            var first = a.createdOn.toDate();\n            var second = b.createdOn.toDate();\n            return first > second ? -1 : 1;\n          });\n          return submissions;\n\n        case 'Oldest':\n          submissions = submissions.sort((a, b) => {\n            var first = a.createdOn.toDate();\n            var second = b.createdOn.toDate();\n            return first < second ? -1 : 1;\n          });\n          return submissions;\n\n        default:\n          return submissions;\n      }\n    };\n\n    this.filter_submissions = submissions => {\n      if (this.props.filter === 'All Posts') {\n        return submissions;\n      }\n\n      console.log('before submissions', submissions);\n      var submissions = [...submissions];\n      var votes = this.state.votes;\n      votes = Object.values(votes);\n      var myVotes = votes.filter(vote => vote.voterID === this.props.uid);\n      submissions = submissions.filter(submission => {\n        var thisVotes = myVotes.filter(vote => vote.pid === submission.pid);\n        var unvoted = true;\n        thisVotes.forEach(vote => {\n          if (vote.value === 1 || vote.value === -1) {\n            unvoted = false;\n          }\n        });\n\n        if (this.props.filter === 'Unvoted') {\n          return unvoted;\n        } else {\n          return !unvoted;\n        }\n      });\n      console.log('after submissions', submissions);\n      return submissions;\n    };\n\n    this.incDec = async num => {\n      var newPointer;\n      var submissions = [...this.state.submissions];\n      submissions = this.sort_submissions(submissions);\n      submissions = this.filter_submissions(submissions); // edge cases for pointer\n\n      if (this.state.pointer + num === submissions.length) {\n        newPointer = 0;\n      } else if (this.state.pointer + num === -1) {\n        newPointer = submissions.length - 1;\n      } else {\n        newPointer = this.state.pointer + num;\n      }\n\n      this.setState(_objectSpread({}, this.state, {\n        popInLeft: 'pop-out-left',\n        popInRight: 'pop-out-right'\n      }), () => {\n        setTimeout(() => {\n          this.setState(_objectSpread({}, this.state, {\n            pointer: newPointer,\n            popInLeft: 'pop-in-left',\n            popInRight: 'pop-in-right'\n          }));\n        }, 600);\n      });\n    };\n\n    this.vote = async vote => {\n      if (this.checkLoggedIn() && this.infoSet()) {\n        var db = firebase.firestore();\n        var myVote = this.findVote();\n        var value = myVote && myVote.value === vote ? 0 : vote;\n        var submissions = [...this.state.submissions];\n        submissions = this.sort_submissions(submissions);\n        submissions = this.filter_submissions(submissions);\n        const submission = submissions[this.state.pointer];\n        console.log(submission, 'vote submission');\n\n        if (myVote) {\n          var updatedVote = _objectSpread({}, myVote, {\n            value: value,\n            date: new Date()\n          });\n\n          db.collection('postVotes').doc(myVote.vid).set(updatedVote).then(() => console.log('vote updated successfully')).catch(err => console.log('could not update vote', err));\n        } else {\n          vote = {\n            value: value,\n            date: new Date(),\n            pid: submission.pid,\n            receiverID: submission.uid,\n            voterID: this.props.uid,\n            postDate: submission.createdOn,\n            address: submission.address\n          };\n          db.collection('postVotes').add(vote).then(() => {\n            this.setState(_objectSpread({}, this.state, {\n              vote: vote\n            }));\n          }).catch(err => {\n            console.log('could not add vote', err);\n          });\n        }\n      }\n    };\n\n    this.checkLoggedIn = () => {\n      if (!this.props.uid) {\n        this.setState(_objectSpread({}, this.state, {\n          showErrMsg: true,\n          errMsg: 'Login to Judge!'\n        }));\n        return false;\n      }\n\n      return true;\n    };\n\n    this.infoSet = () => {\n      if (this.props.needsInfo) {\n        this.setState(_objectSpread({}, this.state, {\n          showErrMsg: true,\n          errMsg: 'Set Info to Judge!'\n        }));\n        return false;\n      }\n\n      return true;\n    };\n\n    this.resetErrState = () => {\n      this.setState(_objectSpread({}, this.state, {\n        showErrMsg: false\n      }));\n    };\n\n    this.toggleModal = async (modal, value, pid) => {\n      this.setState(_objectSpread({}, this.state, {\n        [modal]: value,\n        pid: pid\n      }));\n    };\n  }\n\n  render() {\n    var content;\n    var submissions = [...this.state.submissions];\n    submissions = this.sort_submissions(submissions);\n    submissions = this.filter_submissions(submissions);\n\n    if (submissions.length === 0 || !submissions[this.state.pointer]) {\n      if (this.props.filter === \"Unvoted\") {\n        content = React.createElement(\"div\", {\n          className: \"filter-null-msg\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 302\n          },\n          __self: this\n        }, \"You've voted on all posts!\");\n      } else if (this.props.filter === \"Voted\") {\n        content = React.createElement(\"div\", {\n          className: \"filter-null-msg\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 304\n          },\n          __self: this\n        }, \"You haven't voted on any posts!\");\n      } else {\n        content = React.createElement(\"div\", {\n          className: \"filter-null-msg\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 306\n          },\n          __self: this\n        }, \"Sorry. Having some issues fetching posts.\");\n      }\n    } else {\n      var vote = this.findVote();\n      const upvoteStyle = vote && vote.value === 1 ? 'lit-up' : null;\n      const downvoteStyle = vote && vote.value === -1 ? 'lit-trash' : null;\n      content = React.createElement(FourBars, {\n        showErrMsg: this.state.showErrMsg,\n        onAnimationEnd: this.resetErrState,\n        errMsg: this.state.errMsg,\n        popInLeft: this.state.popInLeft,\n        popInRight: this.state.popInRight,\n        submission: submissions[this.state.pointer],\n        incDec: this.incDec,\n        vote: this.vote,\n        downvoteStyle: downvoteStyle,\n        upvoteStyle: upvoteStyle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 318\n        },\n        __self: this\n      });\n    }\n\n    return React.createElement(\"div\", {\n      className: \"judge-content-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335\n      },\n      __self: this\n    }, this.state.showBars ? content : React.createElement(\"div\", {\n      className: \"loader\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 336\n      },\n      __self: this\n    }, \"Loading...\"));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    uid: state.uid,\n    needsInfo: state.needsInfo,\n    shouldRefetchPosts: state.shouldRefetchPosts\n  };\n};\n\nexport default connect(mapStateToProps, null)(SingleView);","map":{"version":3,"sources":["/Users/davidkang/Desktop/barz/src/containers/Judge/JudgeBarz/SingleView/SingleView.js"],"names":["React","Component","firebase","connect","shuffle","actionTypes","FourBars","SingleView","state","submissions","content","lineOne","lineTwo","lineThree","lineFour","votes","vote","value","pointer","showBars","showErrMsg","errMsg","popInLeft","popInRight","sort","filter","view","showPost","pid","componentDidMount","fetchSubmissions","fetchVotes","setState","db","firestore","collection","get","then","querySnapshot","forEach","doc","post","data","id","push","console","log","catch","err","onSnapshot","findVote","sort_submissions","filter_submissions","currSub","key","voterID","props","uid","vid","a","b","first","createdOn","toDate","second","Object","values","myVotes","submission","thisVotes","unvoted","incDec","num","newPointer","length","setTimeout","checkLoggedIn","infoSet","myVote","updatedVote","date","Date","set","receiverID","postDate","address","add","needsInfo","resetErrState","toggleModal","modal","render","upvoteStyle","downvoteStyle","mapStateToProps","shouldRefetchPosts"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport './SingleView.css'\nimport firebase from 'firebase'\nimport 'firebase/firestore'\nimport { connect } from 'react-redux'\nimport shuffle from 'shuffle-array'\nimport * as actionTypes from '../../../../store/actions'\nimport FourBars from '../FourBars/FourBars'\n\n\nclass SingleView extends Component {\n\n\n    state = {\n\n        submissions: [{\n            content: {\n                lineOne: '',\n                lineTwo: '',\n                lineThree: '',\n                lineFour: '',\n            },\n        }],\n        votes: {\n        },\n        vote: {\n            value: 0\n        },\n\n        pointer: 0,\n        showBars: false,\n        showErrMsg: false,\n        errMsg: 'this is the default errMsg',\n\n        popInLeft: 'pop-in-left',\n        popInRight: 'pop-in-right',\n        vote: null,\n\n        sort: \"Newest\",\n        filter: \"All Posts\",\n        view: \"Explore\",\n\n\n        // ManyPost\n        showPost: false,\n        pid: ''\n\n    }\n\n\n\n    componentDidMount = async () => {\n\n        this.fetchSubmissions()\n        this.fetchVotes()\n\n        this.setState({\n            ...this.state,\n            showBars: true\n        })\n    }\n\n\n    fetchSubmissions = async () => {\n        var db = firebase.firestore()\n        var submissions = []\n        return db.collection('submissions').get().then(querySnapshot => {\n            querySnapshot.forEach((doc) => {\n                var post = {\n                    ...doc.data(),\n                    pid: doc.id\n                }\n                submissions.push(post)\n            })\n            console.log('yeeeehaw')\n            this.setState({\n                ...this.state,\n                submissions: submissions\n            })\n        }).catch(err => {\n            console.log(err)\n        })\n    }\n    fetchVotes = async () => {\n        var db = firebase.firestore()\n        const votes = {}\n        db.collection('postVotes').onSnapshot(querySnapshot => {\n            querySnapshot.forEach((doc) => {\n                var vote = { ...doc.data() }\n                votes[doc.id] = vote\n            })\n            this.setState({\n                ...this.state,\n                votes: votes\n            })\n        }, err => {\n            console.log(err)\n        })\n    }\n    // fetch function\n    findVote = () => {\n        var submissions = [...this.state.submissions]\n        submissions = this.sort_submissions(submissions)\n        submissions = this.filter_submissions(submissions)\n        var currSub = submissions[this.state.pointer]\n        if (currSub) {\n            var votes = this.state.votes\n            for (let key in votes) {\n                var vote = votes[key]\n                if (vote.pid === currSub.pid && vote.voterID === this.props.uid) {\n                    return {\n                        ...vote,\n                        vid: key\n                    }\n                }\n            }\n        } else {\n            return null\n        }\n        \n    }\n\n    sort_submissions = (submissions) => {\n        var submissions = [...submissions]\n        switch (this.props.sort) {\n            case 'Newest':\n                submissions = submissions.sort((a, b) => {\n                    var first = a.createdOn.toDate()\n                    var second = b.createdOn.toDate()\n                    return first > second ? -1 : 1\n                })\n                return submissions\n            case 'Oldest':\n                submissions = submissions.sort((a, b) => {\n                    var first = a.createdOn.toDate()\n                    var second = b.createdOn.toDate()\n                    return first < second ? -1 : 1\n                })\n                return submissions\n            default:\n                return submissions\n        }\n    }\n    filter_submissions = (submissions) => {\n        if (this.props.filter === 'All Posts') {\n            return submissions\n        }\n        console.log('before submissions', submissions)\n        var submissions = [...submissions]\n        var votes = this.state.votes\n        votes = Object.values(votes)\n        var myVotes = votes.filter(vote => vote.voterID === this.props.uid)\n\n        submissions = submissions\n            .filter(submission => {\n                var thisVotes = myVotes.filter(vote => vote.pid === submission.pid)\n                var unvoted = true\n                thisVotes.forEach(vote => {\n                    if (vote.value === 1 || vote.value === -1) {\n                        unvoted = false\n                    }\n                })\n                if (this.props.filter === 'Unvoted') {\n                    return unvoted\n                } else {\n                    return !unvoted\n                }\n            })\n        console.log('after submissions', submissions)\n        return submissions\n    }\n\n    // increments single view post \n    incDec = async (num) => {\n\n        var newPointer;\n        var submissions = [...this.state.submissions]\n        submissions = this.sort_submissions(submissions)\n        submissions = this.filter_submissions(submissions)\n\n        // edge cases for pointer\n        if (this.state.pointer + num === submissions.length) {\n            newPointer = 0\n        } else if (this.state.pointer + num === -1) {\n            newPointer = submissions.length - 1\n        } else {\n            newPointer = this.state.pointer + num\n        }\n\n        this.setState({\n            ...this.state,\n            popInLeft: 'pop-out-left',\n            popInRight: 'pop-out-right'\n        }, () => {\n            setTimeout(() => {\n                this.setState({\n                    ...this.state,\n                    pointer: newPointer,\n                    popInLeft: 'pop-in-left',\n                    popInRight: 'pop-in-right',\n                })\n            }, 600)\n        })\n    }\n\n    // vote and check functions\n    vote = async (vote) => {\n\n        if (this.checkLoggedIn() && this.infoSet()) {\n            var db = firebase.firestore()\n            var myVote = this.findVote()\n            var value = myVote && myVote.value === vote ? 0 : vote\n\n            var submissions = [...this.state.submissions]\n            submissions = this.sort_submissions(submissions)\n            submissions = this.filter_submissions(submissions)\n\n            const submission = submissions[this.state.pointer]\n            console.log(submission, 'vote submission')\n            if (myVote) {\n                var updatedVote = {\n                    ...myVote,\n                    value: value,\n                    date: new Date()\n                }\n                db.collection('postVotes').doc(myVote.vid).set(updatedVote)\n                    .then(() => console.log('vote updated successfully'))\n                    .catch(err => console.log('could not update vote', err))\n            }\n            else {\n                vote = {\n                    value: value,\n                    date: new Date(),\n                    pid: submission.pid,\n                    receiverID: submission.uid,\n                    voterID: this.props.uid,\n                    postDate: submission.createdOn,\n                    address: submission.address\n                }\n                db.collection('postVotes').add(vote)\n                    .then(() => {\n                        this.setState({\n                            ...this.state,\n                            vote: vote\n                        })\n                    })\n                    .catch(err => { console.log('could not add vote', err) })\n\n            }\n        }\n    }\n    checkLoggedIn = () => {\n        if (!this.props.uid) {\n            this.setState({\n                ...this.state,\n                showErrMsg: true,\n                errMsg: 'Login to Judge!'\n            })\n            return false\n        }\n        return true\n    }\n    infoSet = () => {\n        if (this.props.needsInfo) {\n            this.setState({\n                ...this.state,\n                showErrMsg: true,\n                errMsg: 'Set Info to Judge!'\n            })\n            return false\n        }\n        return true\n    }\n    resetErrState = () => {\n        this.setState({\n            ...this.state,\n            showErrMsg: false\n        })\n    }\n\n\n    toggleModal = async (modal, value, pid) => {\n        this.setState({\n            ...this.state,\n            [modal]: value,\n            pid: pid\n        })\n    }\n\n\n\n    render() {\n\n\n        var content;\n        var submissions = [...this.state.submissions]\n        submissions = this.sort_submissions(submissions)\n        submissions = this.filter_submissions(submissions)\n\n        if (submissions.length === 0 || !submissions[this.state.pointer]) {\n            if (this.props.filter === \"Unvoted\") {\n                content = (<div className=\"filter-null-msg\">You've voted on all posts!</div>)\n            } else if (this.props.filter === \"Voted\") {\n                content = (<div className=\"filter-null-msg\">You haven't voted on any posts!</div>)\n            } else {\n                content = (<div className=\"filter-null-msg\">Sorry. Having some issues fetching posts.</div>)\n            }\n        }\n        else {\n\n\n            var vote = this.findVote()\n            const upvoteStyle = vote && vote.value === 1 ? 'lit-up' : null\n            const downvoteStyle = vote && vote.value === -1 ? 'lit-trash' : null\n\n\n            content = (\n                <FourBars\n                    showErrMsg={this.state.showErrMsg}\n                    onAnimationEnd={this.resetErrState}\n                    errMsg={this.state.errMsg}\n                    popInLeft={this.state.popInLeft}\n                    popInRight={this.state.popInRight}\n                    submission={submissions[this.state.pointer]}\n                    incDec={this.incDec}\n                    vote={this.vote}\n                    downvoteStyle={downvoteStyle}\n                    upvoteStyle={upvoteStyle}\n                />\n            )\n\n        }\n\n        return (\n            <div className='judge-content-container'>\n                {this.state.showBars ? content : <div className=\"loader\">Loading...</div>}\n            </div>\n\n        )\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        uid: state.uid,\n        needsInfo: state.needsInfo,\n        shouldRefetchPosts: state.shouldRefetchPosts\n    }\n}\n\n\nexport default connect(mapStateToProps, null)(SingleView)\n"]},"metadata":{},"sourceType":"module"}