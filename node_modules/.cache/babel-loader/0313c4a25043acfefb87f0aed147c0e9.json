{"ast":null,"code":"import _defineProperty from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/davidkang/Desktop/local-barz/src/containers/Wordsmiths/Wordsmiths.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport 'firebase/firestore';\nimport React, { Component, useState, useEffect } from 'react';\nimport shuffle from 'shuffle-array';\nimport joey from '../../assets/videos/joey.m4v';\nimport joeyIMG from '../../assets/images/joeyIMG.png';\nimport firebase from '../../Firebase';\nimport Rappers from './Rappers/Rappers';\nimport WordNavBar from './WordNavBar/WordNavBar';\nimport './Wordsmiths.css';\nimport timeDict from './WordSmithsTools/timeDict';\nimport FireApi from '../../Api/FireApi/FireApi';\n\nconst Wordsmiths = props => {\n  const _useState = useState({\n    rank: \"Best\",\n    time: \"All Time\",\n    state: \"All States\",\n    coast: \"All Coasts\",\n    gender: \"All Genders\"\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        sortFilterState = _useState2[0],\n        setSortFilterState = _useState2[1];\n\n  const _useState3 = useState({}),\n        _useState4 = _slicedToArray(_useState3, 2),\n        rappers = _useState4[0],\n        setRappers = _useState4[1];\n\n  const _useState5 = useState([]),\n        _useState6 = _slicedToArray(_useState5, 2),\n        submissions = _useState6[0],\n        setSubmissions = _useState6[1];\n\n  const _useState7 = useState(true),\n        _useState8 = _slicedToArray(_useState7, 2),\n        fetching = _useState8[0],\n        setFetching = _useState8[1];\n\n  const _useState9 = useState([]),\n        _useState10 = _slicedToArray(_useState9, 2),\n        votes = _useState10[0],\n        setVotes = _useState10[1];\n\n  useEffect(() => {\n    try {\n      const asyncFunction = async () => {\n        setFetching(true);\n        let rappers = {};\n        let submissions = await FireApi.fetchPostsOnce();\n        let votes = await FireApi.fetchVotesOnce();\n        let users = await fetchUsers(); // for every single submission\n\n        submissions.forEach(submission => {\n          // find the votes for that submission\n          let filteredVotes = votes.filter(vote => vote.pid === submission.pid);\n\n          if (!rappers[submission.uid]) {\n            rappers[submission.uid] = {\n              uid: submission.uid,\n              gender: submission.gender,\n              username: submission.username,\n              address: submission.address,\n              votes: filteredVotes,\n              photoURL: users[submission.uid].photoURL,\n              blurb: users[submission.uid].blurb,\n              handles: users[submission.uid].handles\n            };\n          } else {\n            rappers[submission.uid].votes[submission.createdOn] = filteredVotes;\n          }\n        });\n        setRappers(rappers);\n        setSubmissions(submissions);\n        setFetching(false);\n        setVotes(votes);\n      };\n\n      asyncFunction();\n    } catch (err) {\n      setFetching(false);\n      console.log(err);\n    }\n\n    return () => {};\n  }, []); // fetch ALl votes\n\n  const fetchUsers = async () => {\n    let db = firebase.firestore();\n    return db.collection(\"users\").get().then(querySnapshot => {\n      let users = {};\n      querySnapshot.forEach(doc => {\n        users[doc.id] = _objectSpread({}, doc.data(), {\n          uid: doc.id\n        });\n      });\n      return users;\n    }).catch(err => {\n      throw err;\n    });\n  };\n\n  const sortAndFilter = (type, parameter) => {\n    // set appropriate UI\n    if (type === 'state' && parameter !== 'All States') {\n      setSortFilterState(_objectSpread({}, sortFilterState, {\n        coast: 'All Coasts',\n        [type]: parameter\n      }));\n    } else if (type === 'coast' && parameter !== 'All Coasts') {\n      setSortFilterState(_objectSpread({}, sortFilterState, {\n        state: 'All States',\n        [type]: parameter\n      }));\n    } else {\n      setSortFilterState(_objectSpread({}, sortFilterState, {\n        [type]: parameter\n      }));\n    }\n  };\n\n  let displayedRappers = _objectSpread({}, rappers);\n\n  let allVotes = votes ? Object.values(votes) : []; // Filters start\n\n  if (sortFilterState.state !== \"All States\") {\n    displayedRappers = Object.fromEntries(Object.entries(displayedRappers).filter(([k, rapper]) => rapper.address.state === sortFilterState.state));\n  }\n\n  if (sortFilterState.coast !== \"All Coasts\") {\n    displayedRappers = Object.fromEntries(Object.entries(displayedRappers).filter(([k, rapper]) => rapper.address.region === sortFilterState.coast));\n  }\n\n  if (sortFilterState.gender !== \"All Genders\") {\n    displayedRappers = Object.fromEntries(Object.entries(displayedRappers).filter(([k, rapper]) => rapper.gender === sortFilterState.gender));\n  } // Filters end\n  // Tally points start\n\n\n  for (let uid in displayedRappers) {\n    let rapper = displayedRappers[uid];\n    let tally = 0;\n    allVotes.forEach(vote => {\n      let now = new Date();\n      let passedMilliseconds = now - vote.postDate.toDate().getTime();\n      let passedDays = passedMilliseconds / 1000 / 60 / 60 / 24; // tally if within given time \n\n      if (!(passedDays > timeDict[sortFilterState.time]) && uid === vote.receiverID) {\n        tally += vote.value;\n      }\n    }); // if amount of votes is negative make zero\n\n    rapper['tally'] = tally < 0 ? 0 : tally; // submissionCount\n\n    let filteredSubmissions = submissions.filter(submission => {\n      let now = new Date();\n      let passedMilliseconds = now - submission.createdOn.toDate().getTime();\n      let passedDays = passedMilliseconds / 1000 / 60 / 60 / 24;\n      return !(passedDays > timeDict[sortFilterState.time]) && submission.uid === uid;\n    });\n    let noOfSubmissions = filteredSubmissions.length;\n    rapper['submissionCount'] = noOfSubmissions;\n  } // Tally points end\n\n\n  displayedRappers = displayedRappers ? Object.values(displayedRappers) : []; // Sort start\n\n  displayedRappers = sortFilterState.rank === \"Random\" ? // random sort\n  shuffle(displayedRappers) : // best sort\n  displayedRappers.sort((rapper_A, rapper_B) => {\n    return rapper_A.tally < rapper_B.tally ? 1 : -1;\n  }); // Sort end\n  // tally city and coast votes\n\n  let cityVotes = {};\n  let coastVotes = {};\n  displayedRappers.forEach(rapper => {\n    const cityState = \"\".concat(rapper.address.city, \", \").concat(rapper.address.state);\n\n    if (rapper.tally > 0) {\n      cityVotes[cityState] = cityState in cityVotes ? cityVotes[cityState] + rapper.tally : rapper.tally;\n      coastVotes[rapper.address.region] = rapper.address.region in coastVotes ? coastVotes[rapper.address.region] + rapper.tally : rapper.tally;\n    }\n  }); //  Best City and Best Coast reducers\n\n  let bestCity = Object.keys(cityVotes).length ? Object.keys(cityVotes).reduce((a, b) => cityVotes[a] > cityVotes[b] ? a : b) : 'N/A';\n  let bestCoast = Object.keys(coastVotes).length ? Object.keys(coastVotes).reduce((a, b) => coastVotes[a] > coastVotes[b] ? a : b) : 'N/A';\n  return React.createElement(\"div\", {\n    className: \"WordsmithsContainer\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    id: \"backup-img\",\n    src: joeyIMG,\n    alt: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }), React.createElement(\"video\", {\n    id: \"badass\",\n    src: joey,\n    autoPlay: true,\n    loop: true,\n    playsInline: true,\n    muted: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    id: \"WordSmithsOverlay\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  }), React.createElement(WordNavBar, {\n    rank: sortFilterState.rank,\n    time: sortFilterState.time,\n    state: sortFilterState.state,\n    coast: sortFilterState.coast,\n    gender: sortFilterState.gender,\n    sortAndFilter: sortAndFilter,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194\n    },\n    __self: this\n  }), React.createElement(Rappers, {\n    rappers: displayedRappers,\n    rank: sortFilterState.rank,\n    time: sortFilterState.time,\n    state: sortFilterState.state,\n    coast: sortFilterState.coast,\n    gender: sortFilterState.gender,\n    bestCity: bestCity,\n    bestCoast: bestCoast,\n    sort: sortFilterState.rank,\n    fetching: fetching,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201\n    },\n    __self: this\n  }));\n};\n\nexport default Wordsmiths;","map":{"version":3,"sources":["/Users/davidkang/Desktop/local-barz/src/containers/Wordsmiths/Wordsmiths.js"],"names":["React","Component","useState","useEffect","shuffle","joey","joeyIMG","firebase","Rappers","WordNavBar","timeDict","FireApi","Wordsmiths","props","rank","time","state","coast","gender","sortFilterState","setSortFilterState","rappers","setRappers","submissions","setSubmissions","fetching","setFetching","votes","setVotes","asyncFunction","fetchPostsOnce","fetchVotesOnce","users","fetchUsers","forEach","submission","filteredVotes","filter","vote","pid","uid","username","address","photoURL","blurb","handles","createdOn","err","console","log","db","firestore","collection","get","then","querySnapshot","doc","id","data","catch","sortAndFilter","type","parameter","displayedRappers","allVotes","Object","values","fromEntries","entries","k","rapper","region","tally","now","Date","passedMilliseconds","postDate","toDate","getTime","passedDays","receiverID","value","filteredSubmissions","noOfSubmissions","length","sort","rapper_A","rapper_B","cityVotes","coastVotes","cityState","city","bestCity","keys","reduce","a","b","bestCoast"],"mappings":"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","sourcesContent":["import 'firebase/firestore'\nimport React, { Component, useState, useEffect } from 'react'\nimport shuffle from 'shuffle-array'\nimport joey from '../../assets/videos/joey.m4v'\nimport joeyIMG from '../../assets/images/joeyIMG.png'\nimport firebase from '../../Firebase'\nimport Rappers from './Rappers/Rappers'\nimport WordNavBar from './WordNavBar/WordNavBar'\nimport './Wordsmiths.css'\nimport timeDict from './WordSmithsTools/timeDict'\nimport FireApi from '../../Api/FireApi/FireApi'\n\n\n\nconst Wordsmiths = (props) => {\n\n    const [sortFilterState, setSortFilterState] = useState({\n        rank: \"Best\",\n        time: \"All Time\",\n        state: \"All States\",\n        coast: \"All Coasts\",\n        gender: \"All Genders\",\n    })\n    const [rappers, setRappers] = useState({})\n    const [submissions, setSubmissions] = useState([])\n    const [fetching, setFetching] = useState(true)\n    const [votes, setVotes] = useState([])\n\n    useEffect(() => {\n        try {\n\n            const asyncFunction = async () => {\n                setFetching(true)\n                let rappers = {}\n                let submissions = await FireApi.fetchPostsOnce()\n                let votes = await FireApi.fetchVotesOnce()\n                let users = await fetchUsers()\n\n                // for every single submission\n                submissions.forEach(submission => {\n\n                    // find the votes for that submission\n                    let filteredVotes = votes.filter(vote => vote.pid === submission.pid)\n                    if (!rappers[submission.uid]) {\n                        rappers[submission.uid] = {\n                            uid: submission.uid,\n                            gender: submission.gender,\n                            username: submission.username,\n                            address: submission.address,\n                            votes: filteredVotes,\n                            photoURL: users[submission.uid].photoURL,\n                            blurb: users[submission.uid].blurb,\n                            handles: users[submission.uid].handles\n                        }\n                    } else {\n                        rappers[submission.uid].votes[submission.createdOn] = filteredVotes\n                    }\n                })\n                setRappers(rappers)\n                setSubmissions(submissions)\n                setFetching(false)\n                setVotes(votes)\n            }\n            asyncFunction()\n\n        }\n        catch (err) {\n            setFetching(false)\n            console.log(err)\n        }\n        return () => {\n        };\n    }, [])\n\n\n    // fetch ALl votes\n    const fetchUsers = async () => {\n        let db = firebase.firestore()\n        return db.collection(\"users\").get()\n            .then((querySnapshot) => {\n                let users = {}\n                querySnapshot.forEach((doc) => {\n                    users[doc.id] = { ...doc.data(), uid: doc.id }\n                });\n                return users\n\n            })\n            .catch(err => { throw err })\n    }\n\n\n    const sortAndFilter = (type, parameter) => {\n        // set appropriate UI\n        if (type === 'state' && parameter !== 'All States') {\n            setSortFilterState({\n                ...sortFilterState,\n                coast: 'All Coasts',\n                [type]: parameter\n            })\n        } else if (type === 'coast' && parameter !== 'All Coasts') {\n            setSortFilterState({\n                ...sortFilterState,\n                state: 'All States',\n                [type]: parameter\n            })\n        }\n        else {\n            setSortFilterState({\n                ...sortFilterState,\n                [type]: parameter\n            })\n        }\n\n    }\n\n\n    let displayedRappers = { ...rappers }\n    let allVotes = votes ? Object.values(votes) : []\n\n    // Filters start\n    if (sortFilterState.state !== \"All States\") { displayedRappers = Object.fromEntries(Object.entries(displayedRappers).filter(([k, rapper]) => rapper.address.state === sortFilterState.state)) }\n    if (sortFilterState.coast !== \"All Coasts\") { displayedRappers = Object.fromEntries(Object.entries(displayedRappers).filter(([k, rapper]) => rapper.address.region === sortFilterState.coast)) }\n    if (sortFilterState.gender !== \"All Genders\") { displayedRappers = Object.fromEntries(Object.entries(displayedRappers).filter(([k, rapper]) => rapper.gender === sortFilterState.gender)) }\n    // Filters end\n\n\n    // Tally points start\n    for (let uid in displayedRappers) {\n        let rapper = displayedRappers[uid]\n        let tally = 0\n        allVotes.forEach((vote) => {\n            let now = new Date()\n            let passedMilliseconds = now - vote.postDate.toDate().getTime()\n            let passedDays = (passedMilliseconds / 1000 / 60 / 60 / 24)\n            // tally if within given time \n            if (!(passedDays > timeDict[sortFilterState.time]) && uid === vote.receiverID) {\n                tally += vote.value\n            }\n        })\n        // if amount of votes is negative make zero\n        rapper['tally'] = tally < 0 ? 0 : tally\n\n        // submissionCount\n        let filteredSubmissions = submissions.filter(submission => {\n            let now = new Date()\n            let passedMilliseconds = now - submission.createdOn.toDate().getTime()\n            let passedDays = (passedMilliseconds / 1000 / 60 / 60 / 24)\n            return !(passedDays > timeDict[sortFilterState.time]) && submission.uid === uid\n        })\n        let noOfSubmissions = filteredSubmissions.length\n        rapper['submissionCount'] = noOfSubmissions\n    }\n    // Tally points end\n\n\n    displayedRappers = displayedRappers ? Object.values(displayedRappers) : []\n\n    // Sort start\n    displayedRappers = (sortFilterState.rank === \"Random\") ?\n        // random sort\n        shuffle(displayedRappers) :\n        // best sort\n        displayedRappers.sort((rapper_A, rapper_B) => {\n            return (rapper_A.tally < rapper_B.tally) ? 1 : -1\n        })\n    // Sort end\n\n    // tally city and coast votes\n    let cityVotes = {}\n    let coastVotes = {}\n    displayedRappers.forEach(rapper => {\n        const cityState = `${rapper.address.city}, ${rapper.address.state}`\n        if (rapper.tally > 0) {\n            cityVotes[cityState] = (cityState in cityVotes) ?\n                cityVotes[cityState] + rapper.tally\n                : rapper.tally\n            coastVotes[rapper.address.region] = (rapper.address.region in coastVotes) ?\n                coastVotes[rapper.address.region] + rapper.tally\n                : rapper.tally\n        }\n    })\n\n    //  Best City and Best Coast reducers\n    let bestCity = Object.keys(cityVotes).length ? Object.keys(cityVotes).reduce((a, b) => cityVotes[a] > cityVotes[b] ? a : b) : 'N/A'\n    let bestCoast = Object.keys(coastVotes).length ? Object.keys(coastVotes).reduce((a, b) => coastVotes[a] > coastVotes[b] ? a : b) : 'N/A'\n\n\n    return (\n        <div className=\"WordsmithsContainer\">\n            <img id=\"backup-img\" src={joeyIMG} alt=\"\" />\n\n            <video id=\"badass\" src={joey} autoPlay={true} loop={true} playsInline={true} muted />\n            <div id=\"WordSmithsOverlay\" />\n            <WordNavBar\n                rank={sortFilterState.rank}\n                time={sortFilterState.time}\n                state={sortFilterState.state}\n                coast={sortFilterState.coast}\n                gender={sortFilterState.gender}\n                sortAndFilter={sortAndFilter} />\n            <Rappers\n                rappers={displayedRappers}\n                rank={sortFilterState.rank}\n                time={sortFilterState.time}\n                state={sortFilterState.state}\n                coast={sortFilterState.coast}\n                gender={sortFilterState.gender}\n                bestCity={bestCity}\n                bestCoast={bestCoast}\n                sort={sortFilterState.rank}\n                fetching={fetching}/>\n        </div>\n    )\n}\n\nexport default Wordsmiths\n"]},"metadata":{},"sourceType":"module"}