{"ast":null,"code":"import _slicedToArray from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/davidkang/Desktop/local-barz/src/containers/Landing/AuthForm/AuthForm.js\";\nimport React, { useState, useEffect } from 'react';\nimport firebase from 'firebase';\nimport 'firebase/firestore';\nimport validator from 'validator';\nimport './AuthForm.css';\nimport { connect } from 'react-redux';\nimport * as actions from '../../../store/actions/index';\n\nconst AuthForm = props => {\n  // ui state\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        isRegistering = _useState2[0],\n        setisRegistering = _useState2[1];\n\n  let _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      email = _useState4[0],\n      setEmail = _useState4[1];\n\n  let _useState5 = useState(''),\n      _useState6 = _slicedToArray(_useState5, 2),\n      password = _useState6[0],\n      setPassword = _useState6[1];\n\n  const _useState7 = useState(null),\n        _useState8 = _slicedToArray(_useState7, 2),\n        mysteryManBlob = _useState8[0],\n        setMysteryManBlob = _useState8[1]; // login\n\n\n  const _useState9 = useState(false),\n        _useState10 = _slicedToArray(_useState9, 2),\n        spinner = _useState10[0],\n        setSpinner = _useState10[1]; // sign in\n\n\n  const signIn = async event => {\n    if (event) {\n      event.preventDefault();\n    }\n\n    try {\n      const uid = await authenticate(email, password);\n      setSpinner(false);\n      props.getUserData(uid);\n    } catch (err) {\n      switch (err.code) {\n        case 'auth/invalid-email':\n          console.log(err.message);\n          setSpinner(false);\n          break;\n\n        case \"auth/too-many-requests\":\n          let errMsg = \"Too many unsuccessful login attempts. Please try again later.\";\n          console.log(errMsg);\n          setSpinner(false);\n          break;\n\n        case 'auth/user-not-found':\n          console.log(err.message);\n          setSpinner(false);\n          break;\n\n        case 'auth/wrong-password':\n          console.log(err.message);\n          setSpinner(false);\n          break;\n\n        default:\n          setSpinner(false);\n          console.log(err, 'default!');\n      }\n    }\n  }; // authenticate\n\n\n  const authenticate = async (email, password) => {\n    return await firebase.auth().signInWithEmailAndPassword(email, password).then(successObj => {\n      // now's date\n      let expirationDate = new Date(); // now's date + 1 hour\n\n      expirationDate.setHours(expirationDate.getHours() + 100);\n      localStorage.setItem('token', successObj.user.refreshToken);\n      localStorage.setItem('expirationDate', expirationDate);\n      localStorage.setItem('uid', successObj.user.uid);\n      return successObj.user.uid;\n    }).catch(function (error) {\n      console.log(error);\n      throw error;\n    });\n  }; // uploades mysteryman and then...\n\n\n  const uploadMysteryMan = async uid => {\n    let storageRef = firebase.storage().ref();\n    let photoRef = storageRef.child(\"images/\".concat(uid, \"/userIMG.png\"));\n    return photoRef.put(mysteryManBlob).then(async successObj => {\n      // fetches and returns the download URL\n      const url = await successObj.ref.getDownloadURL();\n      return url;\n    }).catch(err => {\n      console.log(err.message);\n    });\n  };\n\n  const fetchMysteryMan = () => {\n    let storage = firebase.storage();\n    storage.ref('mysteryman/mysteryman.png').getDownloadURL().then(url => {\n      let xhr = new XMLHttpRequest();\n      xhr.responseType = 'blob';\n\n      xhr.onload = event => {\n        let blob = xhr.response;\n        setMysteryManBlob(blob);\n      };\n\n      xhr.open('GET', url);\n      xhr.send();\n    }).catch(function (error) {\n      console.log(error);\n    });\n  }; // register \n\n\n  const createAuthUser = async (userInput, password) => {\n    return firebase.auth().createUserWithEmailAndPassword(userInput, password).then(authObj => {\n      return [authObj.user.email, authObj.user.uid];\n    }).catch(err => {\n      throw err;\n    });\n  };\n\n  const createAccount = async (email, inputPass, event) => {\n    event.preventDefault();\n\n    try {\n      let _ref = await createAuthUser(email, inputPass),\n          _ref2 = _slicedToArray(_ref, 2),\n          fireEmail = _ref2[0],\n          uid = _ref2[1];\n\n      const photoURL = await uploadMysteryMan(uid);\n      await createFirebaseUser(fireEmail, uid, photoURL);\n    } catch (err) {\n      console.log(err.message);\n    }\n  };\n\n  const isValidEmail = email => {\n    return validator.isEmail(email);\n  };\n\n  const isValidPassword = password => {\n    return password.length >= 6;\n  };\n\n  return React.createElement(\"div\", {\n    className: \"landing__auth-frame\",\n    style: isRegistering ? {\n      paddingBottom: '2.9em'\n    } : null,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"auth-frame__logo\",\n    style: isRegistering ? {\n      fontSize: '3.2em'\n    } : null,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137\n    },\n    __self: this\n  }, isRegistering ? 'Sign Up' : 'BARZ'), isRegistering ? null : React.createElement(\"div\", {\n    className: \"auth-frame__sub-text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, \"The best hub for your \", React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }), \" inner wordsmith.\"), React.createElement(\"div\", {\n    className: \"auth-frame__login-container\",\n    style: isRegistering ? {\n      marginTop: '.3em'\n    } : null,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    type: \"email\",\n    placeholder: \"Email\",\n    value: email,\n    autoComplete: true,\n    onChange: event => setEmail(event.target.value),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }), React.createElement(\"input\", {\n    placeholder: \"Password\",\n    type: \"password\",\n    value: password,\n    onChange: event => setPassword(event.target.value),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  }), isRegistering ? null : React.createElement(\"div\", {\n    className: \"login-container__forgot-pass-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"forgot-pass-container__button\",\n    onClick: () => props.toggleForgotPass(true),\n    tabIndex: \"-1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, \"Forgot your password?\"))), React.createElement(\"button\", {\n    style: isRegistering ? {\n      marginTop: '2.45em'\n    } : null,\n    className: \"auth-frame__login-button \".concat(email.length > 0 && isValidEmail(email) && isValidPassword(password) && !spinner ? 'auth-frame__login-button--valid' : null),\n    onClick: isRegistering ? event => createAccount(email, password, event) : signIn,\n    disabled: !isValidEmail(email) || !isValidPassword(password) || spinner,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, isRegistering ? 'Create Account' : 'Log In'), React.createElement(\"div\", {\n    className: \"auth-frame__or\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }, \"or\"), React.createElement(\"button\", {\n    className: \"auth-frame__facebook-login\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }, React.createElement(\"i\", {\n    class: \"fab fa-facebook-square facebook-login__icon\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }), React.createElement(\"b\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }, isRegistering ? 'Sign Up' : 'Continue', \" with Facebook\")), isRegistering ? React.createElement(\"div\", {\n    className: \"auth-frame__dont-have\",\n    onClick: () => setisRegistering(false),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }, \"Already have an account? \\xA0\", React.createElement(\"span\", {\n    className: \"dont-have__sign-up\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }, React.createElement(\"b\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }, \"Log In\"))) : React.createElement(\"div\", {\n    className: \"auth-frame__dont-have\",\n    onClick: () => setisRegistering(true),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, \"Don't have an account? \\xA0\", React.createElement(\"span\", {\n    className: \"dont-have__sign-up\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, React.createElement(\"b\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, \"Sign Up\"))));\n};\n\nconst mapStateToProps = state => {\n  return {};\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    getUserData: uid => dispatch(actions.fetchUserData(uid))\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AuthForm);","map":{"version":3,"sources":["/Users/davidkang/Desktop/local-barz/src/containers/Landing/AuthForm/AuthForm.js"],"names":["React","useState","useEffect","firebase","validator","connect","actions","AuthForm","props","isRegistering","setisRegistering","email","setEmail","password","setPassword","mysteryManBlob","setMysteryManBlob","spinner","setSpinner","signIn","event","preventDefault","uid","authenticate","getUserData","err","code","console","log","message","errMsg","auth","signInWithEmailAndPassword","then","successObj","expirationDate","Date","setHours","getHours","localStorage","setItem","user","refreshToken","catch","error","uploadMysteryMan","storageRef","storage","ref","photoRef","child","put","url","getDownloadURL","fetchMysteryMan","xhr","XMLHttpRequest","responseType","onload","blob","response","open","send","createAuthUser","userInput","createUserWithEmailAndPassword","authObj","createAccount","inputPass","fireEmail","photoURL","createFirebaseUser","isValidEmail","isEmail","isValidPassword","length","paddingBottom","fontSize","marginTop","target","value","toggleForgotPass","mapStateToProps","state","mapDispatchToProps","dispatch","fetchUserData"],"mappings":";;AACA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAOC,QAAP,MAAqB,UAArB;AACA,OAAO,oBAAP;AACA,OAAOC,SAAP,MAAsB,WAAtB;AACA,OAAO,gBAAP;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAO,KAAKC,OAAZ,MAAyB,8BAAzB;;AAEA,MAAMC,QAAQ,GAAIC,KAAD,IAAW;AAExB;AAFwB,oBAGkBP,QAAQ,CAAC,KAAD,CAH1B;AAAA;AAAA,QAGjBQ,aAHiB;AAAA,QAGFC,gBAHE;;AAAA,mBAKAT,QAAQ,CAAC,EAAD,CALR;AAAA;AAAA,MAKnBU,KALmB;AAAA,MAKZC,QALY;;AAAA,mBAMMX,QAAQ,CAAC,EAAD,CANd;AAAA;AAAA,MAMnBY,QANmB;AAAA,MAMTC,WANS;;AAAA,qBAQoBb,QAAQ,CAAC,IAAD,CAR5B;AAAA;AAAA,QAQjBc,cARiB;AAAA,QAQDC,iBARC,kBASxB;;;AATwB,qBAUMf,QAAQ,CAAC,KAAD,CAVd;AAAA;AAAA,QAUjBgB,OAViB;AAAA,QAURC,UAVQ,mBAYxB;;;AACA,QAAMC,MAAM,GAAG,MAAOC,KAAP,IAAiB;AAC5B,QAAIA,KAAJ,EAAW;AAAEA,MAAAA,KAAK,CAACC,cAAN;AAAwB;;AACrC,QAAI;AACA,YAAMC,GAAG,GAAG,MAAMC,YAAY,CAACZ,KAAD,EAAQE,QAAR,CAA9B;AACAK,MAAAA,UAAU,CAAC,KAAD,CAAV;AACAV,MAAAA,KAAK,CAACgB,WAAN,CAAkBF,GAAlB;AACH,KAJD,CAKA,OAAOG,GAAP,EAAY;AACR,cAAQA,GAAG,CAACC,IAAZ;AACI,aAAK,oBAAL;AACIC,UAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAhB;AACAX,UAAAA,UAAU,CAAC,KAAD,CAAV;AACA;;AACJ,aAAK,wBAAL;AACI,cAAIY,MAAM,GAAG,+DAAb;AACAH,UAAAA,OAAO,CAACC,GAAR,CAAYE,MAAZ;AACAZ,UAAAA,UAAU,CAAC,KAAD,CAAV;AACA;;AACJ,aAAK,qBAAL;AACIS,UAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAhB;AACAX,UAAAA,UAAU,CAAC,KAAD,CAAV;AACA;;AACJ,aAAK,qBAAL;AACIS,UAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAhB;AACAX,UAAAA,UAAU,CAAC,KAAD,CAAV;AACA;;AACJ;AACIA,UAAAA,UAAU,CAAC,KAAD,CAAV;AACAS,UAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ,EAAiB,UAAjB;AApBR;AAsBH;AACJ,GA/BD,CAbwB,CA6CxB;;;AACA,QAAMF,YAAY,GAAG,OAAOZ,KAAP,EAAcE,QAAd,KAA2B;AAE5C,WAAO,MAAMV,QAAQ,CAAC4B,IAAT,GAAgBC,0BAAhB,CAA2CrB,KAA3C,EAAkDE,QAAlD,EACRoB,IADQ,CACHC,UAAU,IAAI;AAChB;AACA,UAAIC,cAAc,GAAG,IAAIC,IAAJ,EAArB,CAFgB,CAGhB;;AACAD,MAAAA,cAAc,CAACE,QAAf,CAAwBF,cAAc,CAACG,QAAf,KAA4B,GAApD;AACAC,MAAAA,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8BN,UAAU,CAACO,IAAX,CAAgBC,YAA9C;AACAH,MAAAA,YAAY,CAACC,OAAb,CAAqB,gBAArB,EAAuCL,cAAvC;AACAI,MAAAA,YAAY,CAACC,OAAb,CAAqB,KAArB,EAA4BN,UAAU,CAACO,IAAX,CAAgBnB,GAA5C;AACA,aAAOY,UAAU,CAACO,IAAX,CAAgBnB,GAAvB;AAEH,KAXQ,EAYRqB,KAZQ,CAYF,UAAUC,KAAV,EAAiB;AACpBjB,MAAAA,OAAO,CAACC,GAAR,CAAYgB,KAAZ;AACA,YAAMA,KAAN;AACH,KAfQ,CAAb;AAgBH,GAlBD,CA9CwB,CAkExB;;;AACA,QAAMC,gBAAgB,GAAG,MAAOvB,GAAP,IAAe;AACpC,QAAIwB,UAAU,GAAG3C,QAAQ,CAAC4C,OAAT,GAAmBC,GAAnB,EAAjB;AACA,QAAIC,QAAQ,GAAGH,UAAU,CAACI,KAAX,kBAA2B5B,GAA3B,kBAAf;AACA,WAAO2B,QAAQ,CAACE,GAAT,CAAapC,cAAb,EACFkB,IADE,CACG,MAAOC,UAAP,IAAsB;AACxB;AACA,YAAMkB,GAAG,GAAG,MAAMlB,UAAU,CAACc,GAAX,CAAeK,cAAf,EAAlB;AACA,aAAOD,GAAP;AACH,KALE,EAMFT,KANE,CAMIlB,GAAG,IAAI;AAAEE,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAhB;AAA0B,KANvC,CAAP;AAOH,GAVD;;AAYA,QAAMyB,eAAe,GAAG,MAAM;AAC1B,QAAIP,OAAO,GAAG5C,QAAQ,CAAC4C,OAAT,EAAd;AACAA,IAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAyCK,cAAzC,GACKpB,IADL,CACUmB,GAAG,IAAI;AACT,UAAIG,GAAG,GAAG,IAAIC,cAAJ,EAAV;AACAD,MAAAA,GAAG,CAACE,YAAJ,GAAmB,MAAnB;;AACAF,MAAAA,GAAG,CAACG,MAAJ,GAAatC,KAAK,IAAI;AAClB,YAAIuC,IAAI,GAAGJ,GAAG,CAACK,QAAf;AACA5C,QAAAA,iBAAiB,CAAC2C,IAAD,CAAjB;AACH,OAHD;;AAIAJ,MAAAA,GAAG,CAACM,IAAJ,CAAS,KAAT,EAAgBT,GAAhB;AACAG,MAAAA,GAAG,CAACO,IAAJ;AAEH,KAXL,EAWOnB,KAXP,CAWa,UAAUC,KAAV,EAAiB;AACtBjB,MAAAA,OAAO,CAACC,GAAR,CAAYgB,KAAZ;AACH,KAbL;AAcH,GAhBD,CA/EwB,CAgGxB;;;AACA,QAAMmB,cAAc,GAAG,OAAOC,SAAP,EAAkBnD,QAAlB,KAA+B;AAClD,WAAOV,QAAQ,CAAC4B,IAAT,GAAgBkC,8BAAhB,CAA+CD,SAA/C,EAA0DnD,QAA1D,EACFoB,IADE,CACGiC,OAAO,IAAI;AACb,aAAO,CAACA,OAAO,CAACzB,IAAR,CAAa9B,KAAd,EAAqBuD,OAAO,CAACzB,IAAR,CAAanB,GAAlC,CAAP;AACH,KAHE,EAIFqB,KAJE,CAIIlB,GAAG,IAAI;AACV,YAAMA,GAAN;AACH,KANE,CAAP;AAOH,GARD;;AAUA,QAAM0C,aAAa,GAAG,OAAOxD,KAAP,EAAcyD,SAAd,EAAyBhD,KAAzB,KAAmC;AACrDA,IAAAA,KAAK,CAACC,cAAN;;AACA,QAAI;AAAA,iBACuB,MAAM0C,cAAc,CAACpD,KAAD,EAAQyD,SAAR,CAD3C;AAAA;AAAA,UACKC,SADL;AAAA,UACgB/C,GADhB;;AAEA,YAAMgD,QAAQ,GAAG,MAAMzB,gBAAgB,CAACvB,GAAD,CAAvC;AACA,YAAMiD,kBAAkB,CAACF,SAAD,EAAY/C,GAAZ,EAAiBgD,QAAjB,CAAxB;AACH,KAJD,CAKA,OAAO7C,GAAP,EAAY;AACRE,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAhB;AACH;AACJ,GAVD;;AAYA,QAAM2C,YAAY,GAAG7D,KAAK,IAAI;AAC1B,WAAOP,SAAS,CAACqE,OAAV,CAAkB9D,KAAlB,CAAP;AACH,GAFD;;AAGA,QAAM+D,eAAe,GAAG7D,QAAQ,IAAI;AAChC,WAAOA,QAAQ,CAAC8D,MAAT,IAAmB,CAA1B;AACH,GAFD;;AAGA,SACI;AAAK,IAAA,SAAS,uBAAd;AAAuC,IAAA,KAAK,EAAElE,aAAa,GAAG;AAAEmE,MAAAA,aAAa,EAAE;AAAjB,KAAH,GAAgC,IAA3F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI;AAAK,IAAA,SAAS,oBAAd;AAAoC,IAAA,KAAK,EAAEnE,aAAa,GAAG;AAAEoE,MAAAA,QAAQ,EAAE;AAAZ,KAAH,GAA2B,IAAnF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA0FpE,aAAa,GAAG,SAAH,GAAe,MAAtH,CADJ,EAEKA,aAAa,GAAG,IAAH,GACV;AAAK,IAAA,SAAS,wBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAA8D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAA9D,sBAHR,EAMI;AAAK,IAAA,SAAS,+BAAd;AAA+C,IAAA,KAAK,EAAEA,aAAa,GAAG;AAAEqE,MAAAA,SAAS,EAAE;AAAb,KAAH,GAA2B,IAA9F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI;AACI,IAAA,IAAI,EAAC,OADT;AAEI,IAAA,WAAW,EAAC,OAFhB;AAGI,IAAA,KAAK,EAAEnE,KAHX;AAII,IAAA,YAAY,MAJhB;AAKI,IAAA,QAAQ,EAAES,KAAK,IAAIR,QAAQ,CAACQ,KAAK,CAAC2D,MAAN,CAAaC,KAAd,CAL/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,EAOI;AACI,IAAA,WAAW,EAAC,UADhB;AAEI,IAAA,IAAI,EAAC,UAFT;AAGI,IAAA,KAAK,EAAEnE,QAHX;AAII,IAAA,QAAQ,EAAEO,KAAK,IAAIN,WAAW,CAACM,KAAK,CAAC2D,MAAN,CAAaC,KAAd,CAJlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAPJ,EAYKvE,aAAa,GAAG,IAAH,GACV;AAAK,IAAA,SAAS,0CAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI;AACI,IAAA,SAAS,iCADb;AAEI,IAAA,OAAO,EAAE,MAAMD,KAAK,CAACyE,gBAAN,CAAuB,IAAvB,CAFnB;AAGI,IAAA,QAAQ,EAAC,IAHb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BADJ,CAbR,CANJ,EA2BI;AACI,IAAA,KAAK,EAAExE,aAAa,GAAG;AAAEqE,MAAAA,SAAS,EAAE;AAAb,KAAH,GAA6B,IADrD;AAEI,IAAA,SAAS,qCAA8BnE,KAAK,CAACgE,MAAN,GAAe,CAAf,IAAoBH,YAAY,CAAC7D,KAAD,CAAhC,IAA2C+D,eAAe,CAAC7D,QAAD,CAA1D,IAAwE,CAACI,OAAzE,GAAmF,iCAAnF,GAAuH,IAArJ,CAFb;AAGI,IAAA,OAAO,EAAER,aAAa,GAAIW,KAAD,IAAW+C,aAAa,CAACxD,KAAD,EAAQE,QAAR,EAAkBO,KAAlB,CAA3B,GAAsDD,MAHhF;AAII,IAAA,QAAQ,EAAE,CAACqD,YAAY,CAAC7D,KAAD,CAAb,IAAwB,CAAC+D,eAAe,CAAC7D,QAAD,CAAxC,IAAsDI,OAJpE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAKKR,aAAa,GAAG,gBAAH,GAAsB,QALxC,CA3BJ,EAkCI;AAAK,IAAA,SAAS,kBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAlCJ,EAmCI;AAAQ,IAAA,SAAS,8BAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI;AAAG,IAAA,KAAK,EAAC,6CAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,EAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAIA,aAAa,GAAG,SAAH,GAAe,UAAhC,mBAFJ,CAnCJ,EAuCKA,aAAa,GAAG;AAAK,IAAA,SAAS,yBAAd;AAAyC,IAAA,OAAO,EAAE,MAAMC,gBAAgB,CAAC,KAAD,CAAxE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAAgH;AAAM,IAAA,SAAS,sBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAvC,CAAhH,CAAH,GACR;AAAK,IAAA,SAAS,yBAAd;AAAyC,IAAA,OAAO,EAAE,MAAMA,gBAAgB,CAAC,IAAD,CAAxE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAA6G;AAAM,IAAA,SAAS,sBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAvC,CAA7G,CAxCV,CADJ;AA6CH,CA1KD;;AA4KA,MAAMwE,eAAe,GAAGC,KAAK,IAAI;AAC7B,SAAO,EAAP;AAGH,CAJD;;AAMA,MAAMC,kBAAkB,GAAGC,QAAQ,IAAI;AACnC,SAAO;AACH7D,IAAAA,WAAW,EAAGF,GAAD,IAAS+D,QAAQ,CAAC/E,OAAO,CAACgF,aAAR,CAAsBhE,GAAtB,CAAD;AAD3B,GAAP;AAGH,CAJD;;AAOA,eAAejB,OAAO,CAAC6E,eAAD,EAAkBE,kBAAlB,CAAP,CAA6C7E,QAA7C,CAAf","sourcesContent":["\nimport React, { useState, useEffect } from 'react'\nimport firebase from 'firebase'\nimport 'firebase/firestore'\nimport validator from 'validator'\nimport './AuthForm.css'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../store/actions/index'\n\nconst AuthForm = (props) => {\n\n    // ui state\n    const [isRegistering, setisRegistering] = useState(false)\n\n    let [email, setEmail] = useState('')\n    let [password, setPassword] = useState('')\n\n    const [mysteryManBlob, setMysteryManBlob] = useState(null)\n    // login\n    const [spinner, setSpinner] = useState(false)\n\n    // sign in\n    const signIn = async (event) => {\n        if (event) { event.preventDefault() }\n        try {\n            const uid = await authenticate(email, password)\n            setSpinner(false)\n            props.getUserData(uid)\n        }\n        catch (err) {\n            switch (err.code) {\n                case 'auth/invalid-email':\n                    console.log(err.message)\n                    setSpinner(false)\n                    break;\n                case \"auth/too-many-requests\":\n                    let errMsg = \"Too many unsuccessful login attempts. Please try again later.\"\n                    console.log(errMsg)\n                    setSpinner(false)\n                    break;\n                case 'auth/user-not-found':\n                    console.log(err.message)\n                    setSpinner(false)\n                    break;\n                case 'auth/wrong-password':\n                    console.log(err.message)\n                    setSpinner(false)\n                    break;\n                default:\n                    setSpinner(false)\n                    console.log(err, 'default!')\n            }\n        }\n    }\n    // authenticate\n    const authenticate = async (email, password) => {\n\n        return await firebase.auth().signInWithEmailAndPassword(email, password)\n            .then(successObj => {\n                // now's date\n                let expirationDate = new Date()\n                // now's date + 1 hour\n                expirationDate.setHours(expirationDate.getHours() + 100)\n                localStorage.setItem('token', successObj.user.refreshToken)\n                localStorage.setItem('expirationDate', expirationDate)\n                localStorage.setItem('uid', successObj.user.uid)\n                return successObj.user.uid\n\n            })\n            .catch(function (error) {\n                console.log(error)\n                throw error\n            });\n    }\n\n    // uploades mysteryman and then...\n    const uploadMysteryMan = async (uid) => {\n        let storageRef = firebase.storage().ref();\n        let photoRef = storageRef.child(`images/${uid}/userIMG.png`);\n        return photoRef.put(mysteryManBlob)\n            .then(async (successObj) => {\n                // fetches and returns the download URL\n                const url = await successObj.ref.getDownloadURL()\n                return url\n            })\n            .catch(err => { console.log(err.message) })\n    }\n\n    const fetchMysteryMan = () => {\n        let storage = firebase.storage()\n        storage.ref('mysteryman/mysteryman.png').getDownloadURL()\n            .then(url => {\n                let xhr = new XMLHttpRequest();\n                xhr.responseType = 'blob';\n                xhr.onload = event => {\n                    let blob = xhr.response;\n                    setMysteryManBlob(blob)\n                };\n                xhr.open('GET', url);\n                xhr.send();\n\n            }).catch(function (error) {\n                console.log(error)\n            });\n    }\n    // register \n    const createAuthUser = async (userInput, password) => {\n        return firebase.auth().createUserWithEmailAndPassword(userInput, password)\n            .then(authObj => {\n                return [authObj.user.email, authObj.user.uid]\n            })\n            .catch(err => {\n                throw err\n            })\n    }\n\n    const createAccount = async (email, inputPass, event) => {\n        event.preventDefault()\n        try {\n            let [fireEmail, uid] = await createAuthUser(email, inputPass)\n            const photoURL = await uploadMysteryMan(uid)\n            await createFirebaseUser(fireEmail, uid, photoURL)\n        }\n        catch (err) {\n            console.log(err.message)\n        }\n    }\n\n    const isValidEmail = email => {\n        return validator.isEmail(email)\n    }\n    const isValidPassword = password => {\n        return password.length >= 6\n    }\n    return (\n        <div className={`landing__auth-frame`} style={isRegistering ? { paddingBottom: '2.9em' } : null}>\n            <div className={`auth-frame__logo`} style={isRegistering ? { fontSize: '3.2em' } : null}>{isRegistering ? 'Sign Up' : 'BARZ'}</div>\n            {isRegistering ? null : (\n                <div className={`auth-frame__sub-text`}>The best hub for your <br /> inner wordsmith.</div>\n\n            )}\n            <div className={`auth-frame__login-container`} style={isRegistering ? { marginTop: '.3em' } : null}>\n                <input\n                    type='email'\n                    placeholder='Email'\n                    value={email}\n                    autoComplete\n                    onChange={event => setEmail(event.target.value)}></input>\n                <input\n                    placeholder='Password'\n                    type='password'\n                    value={password}\n                    onChange={event => setPassword(event.target.value)}></input>\n                {isRegistering ? null : (\n                    <div className={`login-container__forgot-pass-container`}>\n                        <button\n                            className={`forgot-pass-container__button`}\n                            onClick={() => props.toggleForgotPass(true)}\n                            tabIndex=\"-1\">Forgot your password?</button>\n                    </div>\n                )}\n            </div>\n            <button\n                style={isRegistering ? { marginTop: '2.45em' } : null}\n                className={`auth-frame__login-button ${email.length > 0 && isValidEmail(email) && isValidPassword(password) && !spinner ? 'auth-frame__login-button--valid' : null}`}\n                onClick={isRegistering ? (event) => createAccount(email, password, event) : signIn}\n                disabled={!isValidEmail(email) || !isValidPassword(password) || spinner}>\n                {isRegistering ? 'Create Account' : 'Log In'}\n            </button>\n            <div className={`auth-frame__or`}>or</div>\n            <button className={`auth-frame__facebook-login`}>\n                <i class=\"fab fa-facebook-square facebook-login__icon\"></i>\n                <b>{isRegistering ? 'Sign Up' : 'Continue'} with Facebook</b>\n            </button>\n            {isRegistering ? <div className={`auth-frame__dont-have`} onClick={() => setisRegistering(false)}>Already have an account? &nbsp;<span className={`dont-have__sign-up`}><b>Log In</b></span></div>\n                : <div className={`auth-frame__dont-have`} onClick={() => setisRegistering(true)}>Don't have an account? &nbsp;<span className={`dont-have__sign-up`}><b>Sign Up</b></span></div>\n            }\n        </div>\n    )\n}\n\nconst mapStateToProps = state => {\n    return {\n\n    }\n}\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        getUserData: (uid) => dispatch(actions.fetchUserData(uid))\n    }\n}\n\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AuthForm)\n"]},"metadata":{},"sourceType":"module"}