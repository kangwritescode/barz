{"ast":null,"code":"import _defineProperty from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/davidkang/Desktop/local-barz/src/containers/Wordsmiths/Wordsmiths.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport 'firebase/firestore';\nimport React, { Component, useState, useEffect } from 'react';\nimport shuffle from 'shuffle-array';\nimport joey from '../../assets/videos/joey.m4v';\nimport joeyIMG from '../../assets/images/joeyIMG.png';\nimport firebase from '../../Firebase';\nimport Rappers from './Rappers/Rappers';\nimport WordNavBar from './WordNavBar/WordNavBar';\nimport './Wordsmiths.css';\nimport timeDict from './WordSmithsTools/timeDict';\nimport FireApi from '../../Api/FireApi/FireApi';\n\nconst Wordsmiths = props => {\n  const _useState = useState({\n    rank: \"Best\",\n    time: \"All Time\",\n    state: \"All States\",\n    coast: \"All Coasts\",\n    gender: \"All Genders\"\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        sortFilterState = _useState2[0],\n        setSortFilterState = _useState2[1];\n\n  const _useState3 = useState({}),\n        _useState4 = _slicedToArray(_useState3, 2),\n        rappers = _useState4[0],\n        setRappers = _useState4[1];\n\n  const _useState5 = useState([]),\n        _useState6 = _slicedToArray(_useState5, 2),\n        submissions = _useState6[0],\n        setSubmissions = _useState6[1];\n\n  const _useState7 = useState(true),\n        _useState8 = _slicedToArray(_useState7, 2),\n        fetching = _useState8[0],\n        setFetching = _useState8[1];\n\n  const _useState9 = useState([]),\n        _useState10 = _slicedToArray(_useState9, 2),\n        follows = _useState10[0],\n        setFollows = _useState10[1];\n\n  const _useState11 = useState([]),\n        _useState12 = _slicedToArray(_useState11, 2),\n        votes = _useState12[0],\n        setVotes = _useState12[1];\n\n  useEffect(async () => {\n    try {\n      setFetching(true);\n      let rappers = {};\n      let submissions = await FireApi.fetchPostsOnce();\n      let votes = await FireApi.fetchVotesOnce();\n      let users = await this.fetchUsers(); // for every single submission\n\n      submissions.forEach(submission => {\n        // find the votes for that submission\n        let filteredVotes = votes.filter(vote => vote.pid === submission.pid);\n\n        if (!rappers[submission.uid]) {\n          rappers[submission.uid] = {\n            uid: submission.uid,\n            gender: submission.gender,\n            username: submission.username,\n            address: submission.address,\n            votes: filteredVotes,\n            photoURL: users[submission.uid].photoURL,\n            blurb: users[submission.uid].blurb,\n            handles: users[submission.uid].handles\n          };\n        } else {\n          rappers[submission.uid].votes[submission.createdOn] = filteredVotes;\n        }\n      });\n      setRappers(rappers);\n      setSubmissions(submissions);\n      setFetching(false);\n      setVotes(votes);\n    } catch (err) {\n      setFetching(false);\n      console.log(err);\n    }\n\n    return () => {};\n  }, []); // fetch ALl votes\n\n  const fetchUsers = async () => {\n    let db = firebase.firestore();\n    return db.collection(\"users\").get().then(querySnapshot => {\n      let users = {};\n      querySnapshot.forEach(doc => {\n        users[doc.id] = _objectSpread({}, doc.data(), {\n          uid: doc.id\n        });\n      });\n      return users;\n    }).catch(err => {\n      throw err;\n    });\n  };\n\n  const sortAndFilter = (type, parameter) => {\n    // set appropriate UI\n    if (type === 'state' && parameter !== 'All States') {\n      setSortFilterState(_objectSpread({}, this.state, {\n        coast: 'All Coasts',\n        [type]: parameter\n      }));\n    } else if (type === 'coast' && parameter !== 'All Coasts') {\n      setSortFilterState(_objectSpread({}, this.state, {\n        state: 'All States',\n        [type]: parameter\n      }));\n    } else {\n      setSortFilterState(_objectSpread({}, this.state, {\n        [type]: parameter\n      }));\n    }\n  };\n\n  const toggleFetching = bool => {\n    setFetching(bool);\n  };\n\n  let allVotes = sortFilterStatevotes ? Object.values(sortFilterStatevotes) : []; // Filters start\n\n  if (sortFilterStatestate !== \"All States\") {\n    rappers = Object.fromEntries(Object.entries(rappers).filter(([k, rapper]) => rapper.address.state === sortFilterStatestate));\n  }\n\n  if (sortFilterStatecoast !== \"All Coasts\") {\n    rappers = Object.fromEntries(Object.entries(rappers).filter(([k, rapper]) => rapper.address.region === sortFilterStatecoast));\n  }\n\n  if (sortFilterStategender !== \"All Genders\") {\n    rappers = Object.fromEntries(Object.entries(rappers).filter(([k, rapper]) => rapper.gender === sortFilterStategender));\n  } // Filters end\n  // Tally points start\n\n\n  for (let uid in rappers) {\n    let rapper = rappers[uid];\n    let tally = 0;\n    allVotes.forEach(vote => {\n      let now = new Date();\n      let passedMilliseconds = now - vote.postDate.toDate().getTime();\n      let passedDays = passedMilliseconds / 1000 / 60 / 60 / 24; // tally if within given time \n\n      if (!(passedDays > timeDict[sortFilterStatetime]) && uid === vote.receiverID) {\n        tally += vote.value;\n      }\n    }); // if amount of votes is negative make zero\n\n    rapper['tally'] = tally < 0 ? 0 : tally; // submissionCount\n\n    let filteredSubmissions = sortFilterStatesubmissions.filter(submission => {\n      let now = new Date();\n      let passedMilliseconds = now - submission.createdOn.toDate().getTime();\n      let passedDays = passedMilliseconds / 1000 / 60 / 60 / 24;\n      return !(passedDays > timeDict[sortFilterStatetime]) && submission.uid === uid;\n    });\n    let noOfSubmissions = filteredSubmissions.length;\n    rapper['submissionCount'] = noOfSubmissions;\n  } // Tally points end\n\n\n  rappers = rappers ? Object.values(rappers) : []; // Sort start\n\n  rappers = sortFilterStaterank === \"Random\" ? // random sort\n  shuffle(rappers) : // best sort\n  rappers.sort((rapper_A, rapper_B) => {\n    return rapper_A.tally < rapper_B.tally ? 1 : -1;\n  }); // Sort end\n  // tally city and coast votes\n\n  let cityVotes = {};\n  let coastVotes = {};\n  rappers.forEach(rapper => {\n    const cityState = \"\".concat(rapper.address.city, \", \").concat(rapper.address.state);\n\n    if (rapper.tally > 0) {\n      cityVotes[cityState] = cityState in cityVotes ? cityVotes[cityState] + rapper.tally : rapper.tally;\n      coastVotes[rapper.address.region] = rapper.address.region in coastVotes ? coastVotes[rapper.address.region] + rapper.tally : rapper.tally;\n    }\n  }); //  Best City and Best Coast reducers\n\n  let bestCity = Object.keys(cityVotes).length ? Object.keys(cityVotes).reduce((a, b) => cityVotes[a] > cityVotes[b] ? a : b) : 'N/A';\n  let bestCoast = Object.keys(coastVotes).length ? Object.keys(coastVotes).reduce((a, b) => coastVotes[a] > coastVotes[b] ? a : b) : 'N/A';\n  return React.createElement(\"div\", {\n    className: \"WordsmithsContainer\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    id: \"backup-img\",\n    src: joeyIMG,\n    alt: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }), React.createElement(\"video\", {\n    id: \"badass\",\n    src: joey,\n    autoPlay: true,\n    loop: true,\n    playsInline: true,\n    muted: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    id: \"WordSmithsOverlay\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }), React.createElement(WordNavBar, {\n    rank: sortFilterStaterank,\n    time: sortFilterStatetime,\n    state: sortFilterStatestate,\n    coast: sortFilterStatecoast,\n    gender: sortFilterStategender,\n    sortAndFilter: this.sortAndFilter.bind(this),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  }), React.createElement(Rappers, {\n    rappers: rappers,\n    rank: sortFilterStaterank,\n    time: sortFilterStatetime,\n    state: sortFilterStatestate,\n    coast: sortFilterStatecoast,\n    gender: sortFilterStategender,\n    bestCity: bestCity,\n    bestCoast: bestCoast,\n    sort: sortFilterStaterank,\n    fetching: sortFilterStatefetching,\n    follows: sortFilterStatefollows,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }));\n};\n\nexport default Wordsmiths;","map":{"version":3,"sources":["/Users/davidkang/Desktop/local-barz/src/containers/Wordsmiths/Wordsmiths.js"],"names":["React","Component","useState","useEffect","shuffle","joey","joeyIMG","firebase","Rappers","WordNavBar","timeDict","FireApi","Wordsmiths","props","rank","time","state","coast","gender","sortFilterState","setSortFilterState","rappers","setRappers","submissions","setSubmissions","fetching","setFetching","follows","setFollows","votes","setVotes","fetchPostsOnce","fetchVotesOnce","users","fetchUsers","forEach","submission","filteredVotes","filter","vote","pid","uid","username","address","photoURL","blurb","handles","createdOn","err","console","log","db","firestore","collection","get","then","querySnapshot","doc","id","data","catch","sortAndFilter","type","parameter","toggleFetching","bool","allVotes","sortFilterStatevotes","Object","values","sortFilterStatestate","fromEntries","entries","k","rapper","sortFilterStatecoast","region","sortFilterStategender","tally","now","Date","passedMilliseconds","postDate","toDate","getTime","passedDays","sortFilterStatetime","receiverID","value","filteredSubmissions","sortFilterStatesubmissions","noOfSubmissions","length","sortFilterStaterank","sort","rapper_A","rapper_B","cityVotes","coastVotes","cityState","city","bestCity","keys","reduce","a","b","bestCoast","bind","sortFilterStatefetching","sortFilterStatefollows"],"mappings":"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","sourcesContent":["import 'firebase/firestore'\nimport React, { Component, useState, useEffect } from 'react'\nimport shuffle from 'shuffle-array'\nimport joey from '../../assets/videos/joey.m4v'\nimport joeyIMG from '../../assets/images/joeyIMG.png'\nimport firebase from '../../Firebase'\nimport Rappers from './Rappers/Rappers'\nimport WordNavBar from './WordNavBar/WordNavBar'\nimport './Wordsmiths.css'\nimport timeDict from './WordSmithsTools/timeDict'\nimport FireApi from '../../Api/FireApi/FireApi'\n\n\n\nconst Wordsmiths = (props) => {\n\n    const [sortFilterState, setSortFilterState] = useState({\n        rank: \"Best\",\n        time: \"All Time\",\n        state: \"All States\",\n        coast: \"All Coasts\",\n        gender: \"All Genders\",\n    })\n    const [rappers, setRappers] = useState({})\n    const [submissions, setSubmissions] = useState([])\n    const [fetching, setFetching] = useState(true)\n    const [follows, setFollows] = useState([])\n    const [votes, setVotes] = useState([])\n\n    useEffect(async () => {\n        try {\n            setFetching(true)\n            let rappers = {}\n            let submissions = await FireApi.fetchPostsOnce()\n            let votes = await FireApi.fetchVotesOnce()\n            let users = await this.fetchUsers()\n\n            // for every single submission\n            submissions.forEach(submission => {\n\n                // find the votes for that submission\n                let filteredVotes = votes.filter(vote => vote.pid === submission.pid)\n                if (!rappers[submission.uid]) {\n                    rappers[submission.uid] = {\n                        uid: submission.uid,\n                        gender: submission.gender,\n                        username: submission.username,\n                        address: submission.address,\n                        votes: filteredVotes,\n                        photoURL: users[submission.uid].photoURL,\n                        blurb: users[submission.uid].blurb,\n                        handles: users[submission.uid].handles\n                    }\n                } else {\n                    rappers[submission.uid].votes[submission.createdOn] = filteredVotes\n                }\n            })\n            setRappers(rappers)\n            setSubmissions(submissions)\n            setFetching(false)\n            setVotes(votes)\n        }\n        catch (err) {\n            setFetching(false)\n            console.log(err)\n        }\n        return () => {\n        };\n    }, [])\n\n\n    // fetch ALl votes\n    const fetchUsers = async () => {\n        let db = firebase.firestore()\n        return db.collection(\"users\").get()\n            .then((querySnapshot) => {\n                let users = {}\n                querySnapshot.forEach((doc) => {\n                    users[doc.id] = { ...doc.data(), uid: doc.id }\n                });\n                return users\n\n            })\n            .catch(err => { throw err })\n    }\n\n\n    const sortAndFilter = (type, parameter) => {\n        // set appropriate UI\n        if (type === 'state' && parameter !== 'All States') {\n            setSortFilterState({\n                ...this.state,\n                coast: 'All Coasts',\n                [type]: parameter\n            })\n        } else if (type === 'coast' && parameter !== 'All Coasts') {\n            setSortFilterState({\n                ...this.state,\n                state: 'All States',\n                [type]: parameter\n            })\n        }\n        else {\n            setSortFilterState({\n                ...this.state,\n                [type]: parameter\n            })\n        }\n\n    }\n\n    const toggleFetching = (bool) => {\n        setFetching(bool)\n    }\n\n\n    let allVotes = sortFilterStatevotes ? Object.values(sortFilterStatevotes) : []\n\n    // Filters start\n    if (sortFilterStatestate !== \"All States\") { rappers = Object.fromEntries(Object.entries(rappers).filter(([k, rapper]) => rapper.address.state === sortFilterStatestate)) }\n    if (sortFilterStatecoast !== \"All Coasts\") { rappers = Object.fromEntries(Object.entries(rappers).filter(([k, rapper]) => rapper.address.region === sortFilterStatecoast)) }\n    if (sortFilterStategender !== \"All Genders\") { rappers = Object.fromEntries(Object.entries(rappers).filter(([k, rapper]) => rapper.gender === sortFilterStategender)) }\n    // Filters end\n\n\n    // Tally points start\n    for (let uid in rappers) {\n        let rapper = rappers[uid]\n        let tally = 0\n        allVotes.forEach((vote) => {\n            let now = new Date()\n            let passedMilliseconds = now - vote.postDate.toDate().getTime()\n            let passedDays = (passedMilliseconds / 1000 / 60 / 60 / 24)\n            // tally if within given time \n            if (!(passedDays > timeDict[sortFilterStatetime]) && uid === vote.receiverID) {\n                tally += vote.value\n            }\n        })\n        // if amount of votes is negative make zero\n        rapper['tally'] = tally < 0 ? 0 : tally\n\n        // submissionCount\n        let filteredSubmissions = sortFilterStatesubmissions.filter(submission => {\n            let now = new Date()\n            let passedMilliseconds = now - submission.createdOn.toDate().getTime()\n            let passedDays = (passedMilliseconds / 1000 / 60 / 60 / 24)\n            return !(passedDays > timeDict[sortFilterStatetime]) && submission.uid === uid\n        })\n        let noOfSubmissions = filteredSubmissions.length\n        rapper['submissionCount'] = noOfSubmissions\n    }\n    // Tally points end\n\n\n    rappers = rappers ? Object.values(rappers) : []\n\n    // Sort start\n    rappers = (sortFilterStaterank === \"Random\") ?\n        // random sort\n        shuffle(rappers) :\n        // best sort\n        rappers.sort((rapper_A, rapper_B) => {\n            return (rapper_A.tally < rapper_B.tally) ? 1 : -1\n        })\n    // Sort end\n\n    // tally city and coast votes\n    let cityVotes = {}\n    let coastVotes = {}\n    rappers.forEach(rapper => {\n        const cityState = `${rapper.address.city}, ${rapper.address.state}`\n        if (rapper.tally > 0) {\n            cityVotes[cityState] = (cityState in cityVotes) ?\n                cityVotes[cityState] + rapper.tally\n                : rapper.tally\n            coastVotes[rapper.address.region] = (rapper.address.region in coastVotes) ?\n                coastVotes[rapper.address.region] + rapper.tally\n                : rapper.tally\n        }\n    })\n\n    //  Best City and Best Coast reducers\n    let bestCity = Object.keys(cityVotes).length ? Object.keys(cityVotes).reduce((a, b) => cityVotes[a] > cityVotes[b] ? a : b) : 'N/A'\n    let bestCoast = Object.keys(coastVotes).length ? Object.keys(coastVotes).reduce((a, b) => coastVotes[a] > coastVotes[b] ? a : b) : 'N/A'\n\n\n    return (\n        <div className=\"WordsmithsContainer\">\n            <img id=\"backup-img\" src={joeyIMG} alt=\"\" />\n\n            <video id=\"badass\" src={joey} autoPlay={true} loop={true} playsInline={true} muted />\n            <div id=\"WordSmithsOverlay\" />\n            <WordNavBar\n                rank={sortFilterStaterank}\n                time={sortFilterStatetime}\n                state={sortFilterStatestate}\n                coast={sortFilterStatecoast}\n                gender={sortFilterStategender}\n                sortAndFilter={this.sortAndFilter.bind(this)} />\n            <Rappers\n                rappers={rappers}\n                rank={sortFilterStaterank}\n                time={sortFilterStatetime}\n                state={sortFilterStatestate}\n                coast={sortFilterStatecoast}\n                gender={sortFilterStategender}\n                bestCity={bestCity}\n                bestCoast={bestCoast}\n                sort={sortFilterStaterank}\n                fetching={sortFilterStatefetching}\n                follows={sortFilterStatefollows} />\n        </div>\n    )\n\n}\n\nexport default Wordsmiths\n"]},"metadata":{},"sourceType":"module"}