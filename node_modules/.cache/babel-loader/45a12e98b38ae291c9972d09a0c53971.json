{"ast":null,"code":"import _defineProperty from \"/Users/davidkang/Desktop/local-barz/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/davidkang/Desktop/local-barz/src/containers/Hub/Profile/DeleteAccount/DeleteAccount.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component } from 'react';\nimport firebase from '../../../../Firebase';\nimport 'firebase/firestore';\nimport { connect } from 'react-redux';\nimport './DeleteAccount.css';\nimport trash from '../../../../assets/trash.png';\nimport axios from '../../../../axios-orders';\nimport * as actionTypes from '../../../../store/actions';\n\nclass DeleteAccount extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      password: ''\n    };\n\n    this.onInputHandler = event => {\n      this.setState(_objectSpread({}, this.state, {\n        password: event.target.value\n      }));\n    };\n\n    this.deleteAccount = async () => {\n      var user = firebase.auth().currentUser;\n      var credentials = firebase.auth.EmailAuthProvider.credential(user.email, this.state.password); // first reauthenticate\n\n      user.reauthenticateWithCredential(credentials).then(async () => {\n        var db = firebase.firestore(); // // delete the votes\n\n        await db.collection(\"submissions\").get().then(querySnapshot => {\n          querySnapshot.forEach(doc => {\n            var submission = doc.data();\n            var votes = submission.votes;\n            delete votes[this.props.uid];\n            db.collection(\"submissions\").doc(\"\".concat(doc.id)).update({\n              votes: votes\n            }).then(res => {\n              console.log(res);\n            }).catch(err => {\n              console.log(err);\n            });\n          });\n        }); // delete the submissions\n\n        await db.collection(\"submissions\").where(\"uid\", \"==\", this.props.uid).get().then(snapshot => {\n          snapshot.forEach(doc => {\n            doc.ref.delete();\n          });\n        }); // delete the user\n\n        await db.collection('users').doc(\"\".concat(this.props.uid)).delete().then(res => {\n          console.log(res);\n        }).catch(err => {\n          console.log(err);\n        }); //  remove profile image\n\n        var storage = firebase.storage();\n        var storageRef = storage.ref();\n        var imgRef = storageRef.child(\"images/\".concat(this.props.uid, \"/userIMG.png\"));\n        await imgRef.delete().then(() => console.log('profile image deleted successfully')).catch(() => console.log('issue deleteing profile image')); // delete auth acount\n\n        await firebase.auth().currentUser.delete().then(res => console.log('ACCOUNT WAS DELETED!!!!!')).catch(err => console.log(err));\n        this.props.logout();\n      }).catch(err => console.log('it was not a success to reauthenticate!!!'));\n    };\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"delete-backdrop\",\n      onClick: () => this.props.toggleDeleteAcc(false),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"delete-account-modal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"fa fa-close\",\n      id: \"exit-delete-modal\",\n      onClick: () => this.props.toggleShow('showDeleteAccount', false),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }), React.createElement(\"img\", {\n      id: \"delete-icon\",\n      src: trash,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"are-you-sure\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    }, \"Are you sure?\"), React.createElement(\"div\", {\n      id: \"will-be-deleted\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }, \"All user data will be deleted forever.\"), React.createElement(\"input\", {\n      type: \"password\",\n      id: \"delete-pass-input\",\n      placeholder: \"password\",\n      onChange: this.onInputHandler,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"delete-buttons\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"delete-button\",\n      id: \"cancel\",\n      onClick: () => this.props.toggleShow('showDeleteAccount', false),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }, \"Cancel\"), React.createElement(\"div\", {\n      className: \"delete-button\",\n      id: this.state.password === '' ? 'delete-disabled' : 'delete',\n      onClick: this.state.password === '' ? null : this.deleteAccount,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }, \"Delete\"))));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    uid: state.uid\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    logout: () => dispatch({\n      type: actionTypes.LOG_OUT\n    })\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DeleteAccount);","map":{"version":3,"sources":["/Users/davidkang/Desktop/local-barz/src/containers/Hub/Profile/DeleteAccount/DeleteAccount.js"],"names":["React","Component","firebase","connect","trash","axios","actionTypes","DeleteAccount","state","password","onInputHandler","event","setState","target","value","deleteAccount","user","auth","currentUser","credentials","EmailAuthProvider","credential","email","reauthenticateWithCredential","then","db","firestore","collection","get","querySnapshot","forEach","doc","submission","data","votes","props","uid","id","update","res","console","log","catch","err","where","snapshot","ref","delete","storage","storageRef","imgRef","child","logout","render","toggleDeleteAcc","toggleShow","mapStateToProps","mapDispatchToProps","dispatch","type","LOG_OUT"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport firebase from '../../../../Firebase'\nimport 'firebase/firestore'\nimport { connect } from 'react-redux'\nimport './DeleteAccount.css'\nimport trash from '../../../../assets/trash.png'\nimport axios from '../../../../axios-orders'\nimport * as actionTypes from '../../../../store/actions'\n\nclass DeleteAccount extends Component {\n\n    state = {\n        password: ''\n    }\n\n    onInputHandler = (event) => {\n        this.setState({\n            ...this.state,\n            password: event.target.value\n        })\n    }\n\n\n    deleteAccount = async () => {\n\n        var user = firebase.auth().currentUser;\n        var credentials = firebase.auth.EmailAuthProvider.credential(\n            user.email,\n            this.state.password\n        );\n        // first reauthenticate\n        user.reauthenticateWithCredential(credentials)\n            .then(async () => {\n                var db = firebase.firestore()\n\n                // // delete the votes\n                await db.collection(\"submissions\").get().then(querySnapshot => {\n                    querySnapshot.forEach(doc => {\n                        var submission = doc.data()\n                        var votes = submission.votes\n                        delete votes[this.props.uid]\n                        db.collection(\"submissions\").doc(`${doc.id}`).update({ votes: votes })\n                            .then(res => { console.log(res) })\n                            .catch(err => { console.log(err) })\n                    })\n                })\n                // delete the submissions\n                await db.collection(\"submissions\").where(\"uid\", \"==\", this.props.uid)\n                    .get().then(snapshot => {\n                        snapshot.forEach(doc => {\n                            doc.ref.delete()\n                        })\n                    })\n                // delete the user\n                await db.collection('users').doc(`${this.props.uid}`).delete()\n                    .then(res => { console.log(res) })\n                    .catch(err => { console.log(err) })\n\n                //  remove profile image\n                var storage = firebase.storage();\n                var storageRef = storage.ref();\n                var imgRef = storageRef.child(`images/${this.props.uid}/userIMG.png`)\n                await imgRef.delete()\n                    .then(() => console.log('profile image deleted successfully'))\n                    .catch(() => console.log('issue deleteing profile image'))\n\n                // delete auth acount\n                await firebase.auth().currentUser.delete()\n                    .then(res => console.log('ACCOUNT WAS DELETED!!!!!'))\n                    .catch(err => console.log(err))\n\n\n\n                this.props.logout()\n\n            })\n            .catch(err => console.log('it was not a success to reauthenticate!!!'))\n\n    }\n\n\n    render() {\n\n\n        return (\n            <div>\n                <div className=\"delete-backdrop\" onClick={() => this.props.toggleDeleteAcc(false)} />\n                <div id=\"delete-account-modal\">\n                    <i className=\"fa fa-close\" id=\"exit-delete-modal\" onClick={() => this.props.toggleShow('showDeleteAccount', false)}></i>\n                    <img id=\"delete-icon\" src={trash}></img>\n                    <div id=\"are-you-sure\">Are you sure?</div>\n                    <div id=\"will-be-deleted\">\n                        All user data will be deleted forever.\n                    </div>\n                    <input type=\"password\" id=\"delete-pass-input\" placeholder=\"password\" onChange={this.onInputHandler}></input>\n                    <div id=\"delete-buttons\">\n                        <div className=\"delete-button\" id=\"cancel\" onClick={() => this.props.toggleShow('showDeleteAccount', false)}>Cancel</div>\n                        <div\n                            className={`delete-button`}\n                            id={this.state.password === '' ? 'delete-disabled' : 'delete'} onClick={this.state.password === '' ? null : this.deleteAccount}>Delete</div>\n                    </div>\n                </div>\n            </div>\n\n        )\n    }\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        uid: state.uid\n    }\n}\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        logout: () => dispatch({ type: actionTypes.LOG_OUT })\n    }\n}\n\n\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DeleteAccount);\n"]},"metadata":{},"sourceType":"module"}